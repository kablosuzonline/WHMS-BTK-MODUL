whmcs btkreports modül hata ayıklama talebi


İyi Akşamlar Üstadım
Seninle bir WHMCS Modül projemiz için kod geliştirmeye başlamıştık.
Bu projeyi birlikte belirli bir aşamaya kadar getirdik.
Projenin iskelet yapısı ve sorunlu da olsa bazı kod parçacıkları bile yazdık ama bazı sorunlarda tıkandık.
Ne dersin bu projeyi yeniden gündemimize alalım, birlikte tamamlayalım mı?

Seninle kod geliştirmek istiyorum.
Üstadım Ne dersin var mısın bana yardım etmeye?

whmcs btkreports modül kod geliştirme projesine başlamadan önce mevcut sistem altyapısı hakkında bilgi vermek istiyorum;
sistem pleks linux PHP Version 8.4.8 üzerinde çalışan WHMCS 8.13.1-release.1 version. Proje ekleri arasında Sunucunun phpye ait teknik dokumanıda mevcut.

https://github.com/kablosuzonline/WHMS-BTK-MODUL/tree/main/kutuphane/
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/314_KK_Abone_Desen.docx
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/314_KK_Abone_Desen.pdf
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/WHMCS-PHP_8.4.8_Bilgisi.pdf



WHMCS sistemine ilişkin konfigürasyon ayarları hakkında bilmen gerek bir konuda config.php satırları arasında yer alan:

$templates_compiledir = '/var/www/vhosts/kablosuzonline.com.tr/template_c';

$downloads_dir = '/var/www/vhosts/kablosuzonline.com.tr/yuklemeler/';
$crons_dir = '/var/www/vhosts/kablosuzonline.com.tr/gorev/';
$mysql_charset = 'utf8';
$customadminpath = 'yonet';
$overidephptimelimit = 500;

 $smarty_security_policy = array(
    'system' => array(
        'trusted_dir' => array(
                '/var/www/vhosts/kablosuzonline.com.tr/template_c',

        ),
    ),
 );


Projeye ait kod veya resimlerde bu "URL ADRES" bilgisine iyitaç duyabilirsin


Teknik altyapıdan sonra bizi biraz tanımanı isterim. böylece hedeflerimizi daha iyi analiz edebilirsin.

Şirket Olarak Bilgi Teknolojileri ve İletişim kurumu tarafından İSS ve AİH konularında yetkilendirilmiş olarak iletişim faaliyeti yürüten bir işletmeyiz.
Abonelerimize verdiğimiz hizmetleri ve politikalarımızı tanımak ve anlamak için aşağıda linklerini paylaştığım WHMCS tabanlı kurumsal web sayfamızı da incelemeni istiyorum. 

https://wwww.kablosuzonline.com.tr/wisp/
https://www.kablosuzonline.com.tr/wisp/kurumsal-bilgilerimiz
https://www.kablosuzonline.com.tr/wisp/knowledgebase



Bu modül resmi bir Devlet kurumu olan BTK trafından yetkilendirilmiş olduğumuz konularda sunduğumuz hizmetlere İlişkin; "ABONE REHBER", "ABONE HAREKET" ve "PERSONEL BİLGİLERİNE"  verilerin, yine BTK tarafından sağlanan TEKNİK DÖKÜMANDA (314_KK_Abone_Desen.pdf) istenildiği şekilde göndermek üzerine olduğu için aşağıda linklerini verdiğim adreslerden tüm ilgili mevzuatlar öğrenmeni istiyorum.

https://www.btk.gov.tr/kanunlar

https://www.btk.gov.tr/bakanlar-kurulu-kararlari

https://www.btk.gov.tr/yonetmelikler

https://www.btk.gov.tr/tebligler

https://www.btk.gov.tr/kurul-kararlari (özellikle ceza ve idari yaptırım kararlarını iyi öğrenmelisin ki bizde aynı hatalara düşmeyeleyim)







Öncelikle benimle konuşurken ve modülü yazarken türkçe ile tam uyumlu olmanı istiyorum.
Bu projenin hiç bir aşamasında bana manuel iş yükleme zaman kaybettirme.. her türlü düzeltme derleme işlemlerini senin yapmanı ve bana dosyanın en son düzenlenmiş halinin bütününü eksiksiz olarak vermeni istiyorum.

sana modüle dait bir teknik dokuman (314_KK_Abone_Desen.pdf) gönderiyorum.

btk kurumunun istediğini verileri whmcs üzerinden çekip istenilen dosyaları istenilen zamanda ve istenilen şekilde gönderilmesini sağlayacak bir modül yazmanı istiyorum.

Bu modülün nasıl görünmesine dair (ANASAYFA ve CONFIG Sayfalarına dair) görsel TEMA tasarımlarını ekte gönderdim. temalara ilişkin tpl kodlamalarında bu örnek iki TEMA TASARIMINI kullanarak diğer ekranları da bu şekilde dizayn etmeni istiyorum.


whmcs modül kurulumu esnasında (modülün yönetim bölümünde güncellenebilmesi de sağlanacak şekilde) btk tarafından hangi konularda yetkilendirilmiş olduğunu seçimi sağlanmalı birden çok kutucuk işaretlenmesine olanak sağlanmalı ve seçilen her faaliyet alanına dair istenen verilere ilişkin ayrı ayrı dosyaların oluşması sağlanılmalı.



BTK YETKİ TÜRLERİ DE ŞU ŞEKİLDEDİR.

Yetkilendirme Türü

Altyapı İşletmeciliği Hizmeti (B)

Altyapı İşletmeciliği Hizmeti (K)

GMPCS Mobil Telefon Hizmeti (B)

GMPCS Mobil Telefon Hizmeti (K)

GSM (İmtiyaz Sözleşmesi)

Hava Taşıtlarında GSM 1800 Mobil Telefon Hizmeti (B)

IMT (Sayısı Sınırlandırılmış Kullanım Hakkı Yetki Belgesi)

IMT-2000/UMTS (İmtiyaz Sözleşmesi)

Kablolu Yayın Hizmeti (B)

Ortak Kullanimli Telsiz Hizmeti (K)

Rehberlik Hizmeti (K)

Sabit Telefon Hizmeti (B)

Sabit Telefon Hizmeti (K)

Sanal Mobil Şebeke Hizmeti (B)

Sanal Mobil Şebeke Hizmeti (K)

Uydu Haberleşme Hizmeti (B)

Uydu Platform Hizmeti (B)

Uydu ve Kablo TV Hizmetleri

Çeşitli Telekomünikasyon Hizmetleri (İmtiyaz Sözleşmesi)

İnternet Servis Sağlayıcılığı (B)



Yetki Türlerindeki (B) Yetkinin Bildirim Kapsamında Olduğunu, (K) ise Yetkinin Kullanım Kapsamında Olduğunu ifade etmektedir.



Ayrıca whmcs modül kurulumu esnasında (modülün yönetim bölümünde güncellenebilmesi de sağlanacak şekilde) btk tarafından bildirilen "OPERATÖR KODU" ve "OPERATÖR ADI" ve dosyaların gönderileceği ftp sunucusuna ait bilgilerin ve hangi dosyanın hangi ftp klasörüne yükleneceğine ilişkin tanımların yapılmasını istiyorum.
Config Ekranı sayesinde İlgili Dosyaların gönderilmesi için belirlenene FTP Sunucuyu Belirli Aralıklarla (5 Dakikada bir gibi) Yoklayıp Erişilebilir olup olmadığını kontrol edelim ve Sunucuya Erişim Var İse (Yeşil Renk ile) AKTİF, Şayet Sunucuya Erişim Sağlanamadı ise (Kırmızı Renk ile) PASİF şeklinde modül ana sayfasında info görünsün istiyorum.
Bunlara ilave olarak Modüle İlişkin sürüm güncellemelerine ilişkin zaten hazırladığımız (README.MD gibi) Bir TXT Döküman Hazırlansın ve O dokümana Erişim için Ana Sayfada Link Sağlansın. 
 


Böyle Bir Modülüne ihtiyaç Duymamızın en büyük nedeni BTK tarafından sağlanan TEKNİK Dökümandaki verilerin, WHMCS tarafından karşılanamıyor olması bir çok alan WHMCS'de bulunmuyor bulunanlarda yetersiz kalıyor.

Bu eksiklikleri Customfields üzerinden karşılama düşüncesini daha önceki incelemelerimizde özellikle ürün/hizmet bilgileri kısmında her bir hizmet için ayrı ayrı product fields oluşturmak gerektiği Customfields yapısının Value ve field yapısının iki ayrı tablo ile yönetildiği görüldü bu hem büyük bir veritabanı karmaşasası hemde verinin doğruluk ve bütünlüğünü sağlamanın zorlaşacağına karar verdik. Ayrıca Abone veya Hizmetlere ilişkin Hareketlerin kancalar yardımı ile Customfieldsleri tetikleyemecek olduğunu fark edince

modülün ihtiyaç duyduğu veriler için modulun kendine ait sql tablolarının olmasına karar verdik.



whmcs modül kurulumu esnasında whmcs'de olmayan bu veri alanların teknik dokumanın istediği verileri karşılayacak şekilde oluşturmasını sağlayalım.

yapıtığımız çalışmada ilgili alanların whmcs ile eşleşenlerini de şu şekildedir;



BTK'DAN İSTENEN:	OPERATOR_KOD	MUSTERI_ID	HAT_NO	HAT_DURUM	HAT_DURUM_KODU	HAT_ACIKLAMA	MUSTERI_HAREKET_KODU	MUSTERI_HAREKET_ACIKLAMA	MUSTERI_HAREKET_ZAMANI	HIZMET_TIPI	MUSTERI_TIPI	ABONE_BASLANGIC	ABONE_BITIS	ABONE_ADI	ABONE_SOYADI	ABONE_TC_KIMLIK_NO	ABONE_PASAPORT_NO	ABONE_UNVAN	ABONE_VERGI_NUMARASI	ABONE_MERSIS_NUMARASI	ABONE_CINSIYET	ABONE_UYRUK	ABONE_BABA_ADI	ABONE_ANA_ADI	ABONE_ANNE_KIZLIK_SOYADI	ABONE_DOGUM_YERI	ABONE_DOGUM_TARIHI	ABONE_MESLEK	ABONE_TARIFE	ABONE_KIMLIK_CILT_NO	ABONE_KIMLIK_KUTUK_NO	ABONE_KIMLIK_SAYFA_NO	ABONE_KIMLIK_IL	ABONE_KIMLIK_ILCE	ABONE_KIMLIK_MAHALLE_KOY	ABONE_KIMLIK_TIPI	ABONE_KIMLIK_SERİ_NO	ABONE_KIMLIK_VERILDIGI_YER	ABONE_KIMLIK_VERILDIGI_TARIH	ABONE_KIMLIK_AIDIYETI	ABONE_ADRES_TESIS_IL	ABONE_ADRES_TESIS_ILCE	ABONE_ADRES_TESIS_MAHALLE	ABONE_ADRES_TESIS_CADDE	ABONE_ADRES_TESIS_DIS_KAPI_NO	ABONE_ADRES_TESIS_IC_KAPI_NO	ABONE_ADRES_TESIS_POSTA_KODU	ABONE_ADRES_TESIS_ADRES_KODU	ABONE_ADRES_IRTIBAT_TEL_NO_1	ABONE_ADRES_IRTIBAT_TEL_NO_2	ABONE_ADRES_E_MAIL	ABONE_ADRES_YERLESIM_IL	ABONE_ADRES_YERLESIM_ILCE	ABONE_ADRES_YERLESIM_MAHALLE	ABONE_ADRES_YERLESIM_CADDE	ABONE_ADRES_YERLESIM_DIS_KAPI_NO	ABONE_ADRES_YERLESIM_IC_KAPI_NO	ABONE_ADRES_YERLESİM_NO:	KURUM_YETKILI_ADI	KURUM_YETKILI_SOYADI	KURUM_YETKILI_TCKIMLIK_NO	KURUM_YETKILI_TELEFON	KURUM_ADRES	AKTIVASYON_BAYI_ADI	AKTIVASYON_BAYI_ADRESI	AKTIVASYON_KULLANICI	GUNCELLEYEN_BAYI_ADI	GUNCELLEYEN_BAYI_ADRESI	GUNCELLEYEN_KULLANICI	STATIK_IP	ISS_HIZ_PROFILI	ISS_KULLANICI_ADI	ISS_POP_BILGISI

WHMCS DE VAR OLAN:		tblclients.id	tblhosting.id						WHMCS'DE MÜŞTERİ VE/VEYA ÜRÜNLERE İLİŞKİN HER TÜRLÜ GÜNCELLEMENİN ZAMANI			tblhosting.regdate		tblclients.firstname	tblclients.lastname			tblclients.companyname	tblclients.tax_id																														tblclients.phonenumber		tblclients.email	tblclients.city	tblclients.state																	tblhosting.dedicatedip		tblhosting.username	tblhosting.server 





sana ayrıca yarım kalan projeye ait yazılımı tamamlanan kodları da göndereceğim.

Aslında çalışmada büyük bir yol aldık :)

----------------------------------------





Teknik dökümanda istenen verilerin oluşturulması esnasında; whmcs modülüne ait veritabanı alanlarından "TC.KİMLİK NO" ve "YABANCI KİMLİK NO" alanlara verişi girişi esnasında verilerin Türkiye Cumhuriyeti Devleti, Nüfus ve Vatandaşlık İşleri Genel Müdürlüğü

https://tckimlik.nvi.gov.tr üzerinden doğrulamasını sağlayacak bir api ilave etmeni istiyorum. veri girişi yapıldıktan sonra ikinci bir veri alanına geçerken veya enson verileri kayıt etme aşamasında bu doğrulama yapılabilir hangisi doğru ise onu tercih edebilirsin.

yapılacak bu doğrulama aşamasında api'nin ihtiyaç duyucağı verilerin, TEKNİK DÖKÜMANDA İSTENEN VERİLER ARASINDA OLMASI işimizi kolaylaştıracaktır. 

bu konuda araştırma yap ve en doğru yöntemle doğrulamayı gerçekleştir. hatalı bir sonuç döner ise yanış olan "TC.KİMLİK NO" ve/veya "YABANCI KİMLİK NO" bilgilerini ekranda göster ve bu yanlış verilerin whmcs modülüne ait tablolarına yazılmasına izin verme. Ayrıca Bu doğrulama işlemi teknik veri dosya(larını) oluşturma aşamasında gerçekleşmesini sağlamalısın. Hatalı olan doğrulanmamış olan "TC.KİMLİK NO" ve/veya "YABANCI KİMLİK NO" düzeltilmesi gerektiğinine dair uyarı mesajını ekranda göster ve modülün log klosöründe hataları "TC.KİMLİK NO" ve/veya "YABANCI KİMLİK NO" bilgilerini dair log dosyası oluştur.



Türkiye Cumhuriyeti Vatandaşları için : https://tckimlik.nvi.gov.tr/service/kpspublic.asmx?op=TCKimlikNoDogrula



YABANCILAR için: https://tckimlik.nvi.gov.tr/service/kpspublicyabancidogrula.asmx?op=YabanciKimlikNoDogrula





ÖRNEK BTK Abone verisi:



701|;|1000001|;|1343|;|A|;|1|;|AKTIF|;|1|;|HAT DURUM DEGISIKLIGI|;|20240517030741|;|WIFI|;|G-SIRKET|;|20160824080000|;|00000000000000|;|TAMER|;|GENÇEL|;||;||;||;|32479043158|;||;|E|;||;||;||;||;||;|0000-00-00|;||;|ONODEMELI|;|0|;|0|;|0|;||;||;||;||;||;||;|0000-00-00|;|B|;|BALIKESİR|;|AYVALIK|;|KÜÇÜKKÖY MAHALLESİ ATATÜRK BUL. AZEMBEY SOK.|;|AZİM APT. NO:6 D:2 (1031832817)|;||;||;|10410|;|0|;|+90.542 615 61 88|;||;|tamer.gencel@kablosuzonline.com.tr|;|BALIKESİR|;|AYVALIK|;|KÜÇÜKKÖY MAHALLESİ ATATÜRK BUL. AZEMBEY SOK.|;|AZİM APT. NO:6 D:2 (1031832817)|;||;||;|0|;|TAMER|;|GENÇEL|;|0|;|+90.542 615 61 88|;|KÜÇÜKKÖY MAHALLESİ ATATÜRK BUL. AZEMBEY SOK. AZİM APT. NO:6 D:2 (1031832817) AYVALIK BALIKESİR|;||;||;||;||;||;||;|192.168.1.258|;||;|32479043158|;|2\n



---------------------------------------------



bir önemli husus daha var, Tüm Adres Bilgilerinin (İL, İLÇE, MAHALLE, SOKAK/CADDE/BULVAR, BİNA ADI, DIŞ KAPI NO, İÇ KAPI NO, ADRES KODU, POSTA KODU gibi ) tüm adres bilgilerinin ister YERLEŞİM, ister TESİS, ister ise KURUM YETKİLİSİNE ait olsun tüm adreslerin doğruluğunu ve bütünlüğünü sağlamak için BTK tarafından nvi adres doğrulama istenmektedir. Ancak NVİ ile yapılan tüm görüşmelerde KPS sistemine dair taleplerimiz kabul edilmedi.



-----------------------------------------------



Doğrulama yapamadığımız için Modül içindeki Tüm Adres Bilgilerinin (İL, İLÇE, MAHALLE, SOKAK/CADDE/BULVAR, BİNA ADI, DIŞ KAPI NO, İÇ KAPI NO, POSTA KODU gibi ) Bilgilerin Sisteme girişinde oluşacak insan ve kalavye hatalarının önünde geçebilmek ve veri girişini hızlanladırabilmek için Seçmeli Drop Menüler ile (İL Seçilince, O İL'in İLÇELERİ, İLÇELER arasından yapılacak seçimle o ilçeye ait Mahalleler, Mahalle Seçilince, O Mahalleye ait Cadde/Sokak/Bulvar, Cadde/Sokak/Bulvar seçildiğinde BİNA ADI veya BİNA NO, Bina adı veya Bina  No Seçildiğinde ise DAİRE NO) bilgilerinin bir drop menü araclığı ile ekrana getirilmesi sağlamalısın. böylece personel ve klavye giriş hataları  ortadan kaldırılır. daha önce bu verilerin java üzerinde mi yoksa veritabanında mı tutmak konusunda yaptığımız tartışmada veritabanında tutulmasının daha doğru olacağına karar verdik.





Adreslere ilişkin bir diğer önemli hususta evet whmcs müşteri bölümünde adres girilebiliyor ancak bu adresler hem btk'nın istediği gibi İL, İLÇE, MAHALLE, SOKAK/CADDE/BULVAR , BİNA ADI, DIŞ KAPI NO, İÇ KAPI NO, POSTA KODU , ADRES KODU gibi adres bilgilerini ve btk'nın talep ettiği aboneye ait kimlik bilgilerini gibi bir çok spesifik veriyi içermiyor. ayrıca en büyük eksikliklerden birisi de evet yetersizde olsa aboneye ilişkin bir adres var ve hatta birden çok kontak bilgisi de ilave edilebiliyor ancak, bazen bir müşteri birden çok adreste hizmet alabiliyor örneğin aynı abone  evinde, iş yerinde, merkezinde, şubesinde, fabrikasında, ofisinde bir den çok hizmete farklı farklı adreslerde ürün ve hizmetleri olabiliyor btk bunların hepsinin her bir ürün için TESİS ADRESİ olarak detaylandırılması isteniyor özetle btk abone değil aktif pasif tüm ürünlerin raporlanmasını istemektedir.

BTK Teknik Dosyasında Raporlanması istenen Abone YERLEŞİM(İkamet) Adresi Whmcs yönetim panelindeki "clients profile" bölümden girişi sağlanmalı.

Aboneye Hizmet ve Ürün Satışı Esnasında veya Sonrasında (clients services" bölümünde olabilir) YERLEŞİM ve HİZMET TESİS Adresi Aynı olup olmadığı sorulsun (seçim kutucuğu konulabilir).

Şayet Yerleşim ve Hizmet Tesis adresi aynı ise Yerleşim adresindeki verilerin otomatik olarak TESİS ADRESİ "clients services" bölümüne de işlenmesi sağlansın. BTK aynı bile olsa bu iki adresinde girilmesini istiyor.

Ayrıca Aboneye ait bile olsa Her bir ürün/hizmet için ayrı ayrı "tesis adresi" whmcsdeki "clients services" bölümünden girilmesi sağlanmalı.

Modülün ana konusu olan BTK Rapor(ları) için gerekli olmasa da ek olarak abonenin internet erişim hizmetine ilşkin bakım ve onarım için giden teknik ekibin tesis adresini google map üzerinden konum bilgisi alanı da eklensin. Böylece Teknik ekip direk konuma gideceği için daha hızlı ulaşım sağlayacaktır.


--------------------------------------------

WHMCS'nin mevcut yapısının bazı sınırlamaları olduğunu ve iş gereksinimlerinizi tam olarak karşılamamıyor.





Özetle, sorun şu:



WHMCS, müşterilerin fatura adreslerini yönetmek için iyi bir sistem sunuyor.

Ancak, hizmetlerin sunulduğu adresler (tesis adresleri) her zaman fatura adresleriyle aynı olmayabiliyor.

Bir müşterinin birden fazla hizmeti farklı adreslerde olabilir (ev, iş yeri, şube vb.).

WHMCS'nin mevcut yapısı, tesis adreslerini hizmetlerle ilişkilendirme konusunda yetersiz kalıyor.

Çözüm Önerisi: clientsservices'e Adres Alanları Eklemek



Bu sorunu çözmek için, "clients services" ekranına adres alanları eklemek mantıklı bir çözüm gibi görünüyor. Bu, her bir hizmet kaydına özel bir adres atamanızı sağlayacaktır.





-------------------------------------------------



yine aynı teknik dokümanda dosyaların ftp sunucuna yüklenilmesinden bahsediliyor. her bir işletmecinin kendi ftp sunucusu olduğu için burada teknik dokumanda genel bir ifade kullanılmıştır. bu ftp sunuculara ilişkin bilgiler ve oluşturulacak olan her bir dosyanın yükleneceği klasörler farklıdır. ve süreç içinde bu klasörlerin değiştirildiğini göz önüne alınır ise bu ftp sunucusuna ait erişim bilgileri ve yüklenecek dosyaların hedef yollarını da kod içine gömmek yerine modül ilk kurulurken bu bilgilerin girilmesini ve ilerde oluşacak bir değişik söz konusu olduğunda bu bilgilerin yönetim ara yüzünden güncellenmesini sağlamak daha doğru olacaktır.



--------------------------------------------------





modülün tüm kurulum ve yönetim aşamasının güncellenebilen esnek bir yapıya sahip olsun istiyorum.





hooks demişken BTK'nın üzerinde durduğu hassasiyet gösterdiği konulardan birisi da istediğini verilerden birisi bile değişse veya hareket görse HAREKET dosyasına anında yansımasını istiyor bu yüzden kancalar çok önemli :) ayrıca BTK TEKNİK DOKUMANINI detaylı incelersen REHBER dosyaları  Aktif/Pasif/İptal durumu ne olursa olsun tüm Geçmiş veya Mevcut Abone Bilgilerini her ay belirtilen gün ve saatte gönderilmesi gerekiyor.

Diğer HAREKET Dosyası ise Her gün Belirtilen Saatte Bir Önceki gündeki gönderim zamanından bu yana biriken hareketlerin gönderilmesini istiyor.

yani FTP sunucuna bırakılan bir HAREKET diğer günün hareket dosyasında olmaması gerekiyor bu da demek oluyor ki;

REHBER Dosyasında oluşan hiç bir kayıt silinemez ancak güncellenebilir (gerekiyorsa silme korumalı yapılabilir Aboneye Ait Bazı Bilgiler ASLA Değiştirilemez TC. Kimlik No, Ad, Soyad gibi)

Ancak Gönderilmiş olan HAREKET dosyası içinde yer alan veri (şayet veri tabanında tutuluyor ise) HAREKET.ABN.GZ dosyasına yazıldığı an veritabanından silinmeli ki mükerret hareket kaydı oluşmasın.





BTK YETKİLENDİRME TÜRLERİNİ çok iyi anlamanı istiyorum. hassas bir konu Bir işletmeci Birden çok YETKİLENDİRME TÜRÜNE Sahip olabilir.  Ürünlerin/hizmetlerin hangi YETKİ TÜRÜNE haiz olduğunu her ürün veya ürün gurubu için belirlenmeli ve o yetki türüne ait gönderim şekline ve dosya formatına gönderilmeli. Diyelim ki bir işletmeci Hem ISS hemde AİH yetki türüne sahip ama sadece İSS abonesi ve hizmeti sunmuş. BTK zaman zaman karar değişikliğine gidip boşta olsa eğer o türe ait yetkilendirilmiş isen boş bile olsa o dosyayı FTP yükleyeceksin diyebilmektedir. yönetim ekranında abone/hizmet olmasada boş veri gönder diye bir kutucuk konulmasında fayda var ne dersin?





bu konu biraz karışık sana şöyle özetliyeyim bir İnternet Servis Sağlama işini, Nihai son kullanıcıya sunar isen bu İSS yetkisi kapsamında değerlendiriliyor, ancak aynı ürünü yine sizin gibi BTK tarafından yetkilendirilmiş bir başkaca işletmeciye bu hizmeti sunuyor iseniz ve o hizmet üzerinden o işletmeci kendi abonelerine hizmet veriyor ise yani sizden alıp başkasına satıyor ise o zaman BTK sizin o hizmet AİH (altyapı İşletmeciliği Hizmeti) kapsamında değerlendiriyor. yani ürünün veya hizmetin ne olduğu kadar.. abonenin de kim olduğu etken... bu konuyu da öğrendiğine göre önerilerini tekrar dinlemek isterim.







ayrıca sana modülün şu ana kadar ki gelinen noktasını gösteren modul-durum-raporu.pdf raporunu göndereceğim ve yazdığımız kodların son hallerini de oradan devam edelim.



senden WHMCS 8.13.1-release.1 versionunu ve PHP Version 8.4.8 desteği olan (konumuzun dışında bile olsa) tüm whmcs kancalarını öğrenmeni istiyorum.

Ayrıca birazdan bir whmcs-whatsapp Modülüne ait dosyaları da göndereceğim. lütfen onları da incele bizim projeye yakın bir modül. bu modül hook yardımı ile hertürlü müşteri ve ürün değişikliğini aynı anda whatsapp mesajlarını anlık olarak gönderiyor.




-------------------------------------------



BTK tarafından alınan ilgili bir karar ile Her yılın 6. Ve 12. Aylarının sonuna kadar (EK'teki excel örneğindeki bilgileri içerecek şekilde) Mevcut Personel bilgilerin iletilmemesi durumunda ilgili mevzuat hükümleri uyarınca BTK Kurumu tarafından idari yaptırım uygulama yoluna gitme hakkına haiz bulunduğu bilgisine ulaştık.
Bu kez dosya ekteki örnek excel dosya şeklinde yine aynı ftp adresine ancak farklı bir klasöre bırakılması gerekiyor. config ekranından zaten ftp sunucu bilgileri giriş ekranı mevcut idi.. "ABONE HAREKET" Ftp dosya yolunun olduğu giriş alanının hemen altına (CONGIG TEMA TASARIM RESMİNDE OLDUĞU GİBİ) persenel listesini içeren EXCEL dosyasının hangi ftp klasörüne gönderileceğine dair bir giriş alanı olsun.
Personel listesini ve bilgilerin bir bölümü whmc yöneticiler (configadmins) bölümündeki (excelldeki taleplerle eşleşenleri) verileri oradan çekeceğiz. Ancak bu whmcs bölümü istenen tüm bilgileri kapsamıyor.
O nedenle mod_btk_personel adlı oluşturulacak sql tablosuna ihtiyaç duyacağız.

Bu SQL TABLO (mod_btk_personel) Modül İnstall Aşamasında iken oluşturulması sağlanacak.
modül kuruluş aşamasında iken ilk anda zaten whmcs yöneticiler "configadmins" bölümünden ("tbladmins" SQL TABLOSUNDA TUTULUYOR) var olan ve eşleşen alanların "mod_btk_personel" sql tablosuna yazılması sağlansın.
Ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak bu tabloya da yazılması sağlansın.

BU SQL TABLOSUNDA AŞAĞIDAKİ ALANLARDAN OLUŞACAK;


personel_id (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personel için modül tarafından "anahtarlama" (benzersiz) olacak şekilde otomatik oluşturulsun. ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın. whmcs üzerinden çekilecek veriler için kullanacağımız "tbladmins" Sql tablosunun "id" alanı ile "FOREIGN KEY" olarak tanımlanması sağlansın.)

Firma Adı (Modülün config Bölümündeki, "OPERATOR KODU" ve "OPERATOR ADI" bölümlerinin olduğu sql tablosuna ve config.tpl sayfasına "OPERATOR UNVANI" alanı da eklensin ve mod_btk_personel SQL tablosundaki her personel için oradan yazılsın. ancak bu alan hiç bir şekilde "ABONE REHBER" ve/veya "ABONE HAREKET" dosya içeriklerinde yer almayacak. Sadece PERSENOL ALANI için kullanılacaktır.)    

bu konudaki şu detayı bilmelisin "OPERATOR ADI" ile "OPERATOR ÜNVANI" aynı şey değil.. "OPERATOR ADI", BTK tarafından belirleniyor genelde şirket unvanlarının kısa isimlerinden oluşuyor türkçe karekter kıllanılmıyor ve buyuk harf ile yazılıyor ve karakterler arasında boşluk olmuyor bunların nedenini sende tahmin etmiş olmalısın.. OPERATOR ADI oluşturulacak olan dosyaların adını ilave geliyor.. örneğin bizim OPERATOR ADI : IZMARBILISIM


"OPERATÖR UNVANI" Şirketin Ticaret sicilinde tescilli resmi adıdır. Tescilde Nasıl yazılıyor ise hiç bir değişiklik yapılmadan aynen yazılır. Bizim Resmi Şirket Unvanımız: İZMAR BİLİŞİM HİZMETLERİ SANAYİ TİCARET LİMİTED ŞİRKETİ

"OPERATÖR UNVANI" Bu datayı sadece PERSONEL Listesi içeren EXCEL dosyasında kullanacağız. 



Adı (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personele ait "tbladmins" Sql tablosunun "firstname" alanından alınsın, ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın.)

Soyadı (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personele ait "tbladmins" Sql tablosunun "lastname" alanından alınsın, ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın.)

TC Kimlik No (Müşteri/Abone tarafında zaten doğrula olayını yapmıştık oradaki çalışma üzerinden bu "TC Kimlik No" alanındaki verilerde yine aynı metodla doğrulansın)

Ünvan (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

Çalıştığı birim (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

Mobil telefonu (alan koduyla birlikte 10 hane olarak giriniz), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

Sabit telefonu (alan koduyla birlikte 10 hane olarak giriniz), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

E-posta adresi (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personele ait "tbladmins" Sql tablosunun "email" alanından alınsın, ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın.)

EV ADRESİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. İleride bu modül "GÜNÜN BİRİNDE BTK BU BİLGİLERİN GÖNDERİMİNDEN VAZGEÇZE BİLE" Yazdığımız bunca kod boşa gitsin istemem, "PERSONEL İK" olarak geliştirebiliriz. İleri dönük olsun), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

ACİL DURUMDA ARANACAK KİŞİ VE İLETİŞİM BİLGİLERİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. İleride bu modül "GÜNÜN BİRİNDE BTK BU BİLGİLERİN GÖNDERİMİNDEN VAZGEÇZE BİLE" Yazdığımız bunca kod boşa gitsin istemem, "PERSONEL İK" olarak geliştirebiliriz. İleri dönük olsun), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

İŞE BAŞLAMA TARİHİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum.), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

İŞTEN AYRILMA TARİHİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. Zira BTK Excel Dosya Gönderme anında ki İŞ İLİŞİĞİ KESİLENLER HARİÇ, mevcut çalışanların listesini istiyor), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
 
İŞ BIRAKMA NEDENİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. İleride bu modül "GÜNÜN BİRİNDE BTK BU BİLGİLERİN GÖNDERİMİNDEN VAZGEÇZE BİLE" Yazdığımız bunca kod boşa gitsin istemem, "PERSONEL İK" olarak geliştirebiliriz. İleri dönük olsun), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)

modülün personel yönetim ekranı olan personel.tp ekranında listenen tüm personelin son kısmında bir anahtarlama (seçim) olsun. (BTK LİSTESİNE EKLENSİN) Şeklinde çünkü personel bilgisini whmcs yöneticiler "configadmins" bölümünden çağıracağımız için orada aslında var olmayan ancak bazı entegrasyonlar için (Banka, Sanal Pos v.b. API Erişimleri için) oluşturulmuş hesaplar olabiliyor onların BTK Raporuna eklenmesi doğru olmaz.


Oluşturalacak excel dosyasının adı : Dosyanın adı diğer "ABONE REHBER" ve "ABONE HAREKET" Dosyalarından biraz farklı olacak dosyanın adında ("OPERATOR ADI"_Personel_Listesi_"DOSYA HAZIRLAN YILI"_"DOSYA HAZIRLAN AYI") Örneğin: IZMARBILISIM_Personel_Listesi_2024_6.xlsx Şeklinde Config.tpl'de belirtilen FTP SUNUCUNUN, personel.tpl'de Dosya Yolu belirtilen FTP Klasörüne excel (formatında) kayıt edilecek. 

Oluşturulma zamanları : Her yılın 6. Ve 12. Aylarının son günü saat 16:00

oluşturulan dosyanın içeriği: Dosyanın gönderim zamanında mevcut çalışan personelin listesi


Sana gönderdiğim modul-dosya-tree-yapısı.pdf dosyasını incelersen zaten sende fark edeceksin projenin iskelet yapısını zaten daha önceki seninle olan çalışmalarımızda bir yere kadar getirdik.. kaldığımız yerden devam edelim istiyorum.

Projenin ilerleyen aşamalarında Hatalı veya eksik bölümleri beraber geliştirelim. Örneğin Henüz whmcs Müşteri Panelinde giren Müşterilerin(Abonelerin), Kendisine Ait Bilgilerin "clientarea.php?action=details" ekranında görebileceği ama Hiç bir şekilde Değiştirme, Düzeltme veya Silme Yapamayacağı sayfaların kodlanması gerekiyor.  

Ayrıca projenin her aşamasında senin öngörü ve tavsiyelerine açığım. Her türlü katkın beni mutlu edecektir.

Ne Dersin devam edelim mi?

Konuyu en ince ayrıntısına kadar öğrenebilmen için "WHMCS_BTK_Modül_Geliştirme_Projesi_.docx" gibi bir çok dokumantasyon sağladım lütfen detaylı incele ve tüm enerjini bu projeyi tamamlamaya harca.

NOTLAR:
Dikkat edilmesi gereken bazı hususları aktarmak istiyorum. Whmcs Yazılım ekibi çok sık Altı ayda bir gibi sürekli yeni version üretiyorlar.
Çok sık olarak Whmcs kod ve sql tablo yapısının değiştiğini göz önüne alarak mümkün olduğunca whmcs'nin kendi yapısal bütünlüğünü etkilemekten kaçınmalısın. değilse ise WHMCS'nin çıkaracağı ilk yeni versionda modülümüz uyum sorunu yaşayabilir. 




Projenin her aşamasında proaktif rol almak istiyorum. Her saat başında projeye ait dosya içeriklerini benimle paylaşmanı istiyorum. KOntrolün bende olmasını istiyorum.
Lütfen Arka Planda Yaptığın veya Yapmayı Hedeflediğin en ufak ayrıntıyı bile kaçırmadan bana belirli aralıklar ile bana rapor vermeni istiyorum.
Senden belirli aralıklarla son durum raporu isterim... arka planda yaptığın çalışmalardan beni haberdar etmelisin. Sürecin her adımında beni bilgilendir.
Ayrıca Türkiye'yaşıyorum Kendini (Türkiye/İstanbul) Zamanına göre ayarla.
Ayrıca Proje Aşamasında Talimat ve ayrıntıları unutmaman için ilk talimatları ve proje detay bilgilerini "Gemini_Pro_Talimatlar.txt" Gemini Pro Klasörüne yükledim. unutursan hatırlarsın..



Özellikle dikkat etmen gereken hususları ifade etmek istiyorum;


BTK rehber dosyada durumu ne olursa olsun (aktif/pasif/ iptal/ dondurulmuş diye ayırmadan) tüm hizmetlerin raporlanmasını istiyor.
Bir abonenin (aynı adreste veya farklı bir adreste) birden fazla hizmeti olabilir. böyle bir durumda her bir hizmet içinn ayrı ayrı kayıt satırı açılacak.
BTK'ya gönderilecek olan "ABONE REHBER" ve "ABONE HAREKET" dosyalarındaki bilgilerin eksiksiz oluşturalabilmesi için (ABONEYE VE HİZMETE DAİR TÜM VERİLERİN GİRİLMESİNİN SONRASINDA... ) hizmete ilişkin "siparişi onayla" tuşuna basıldığı an sipariş onay kancasının tetiklemesi ile birlikte "ABONE REHBER, YENİ ABONE" ve "ABONE HAREKET, YENİ ABONE" olacak şekilde ilk kayıt(lar) oluşsun.
Böylece BTK'ya EKSİK BİLGİ gitmemiş olacaktır.


Raporların dosya isim yapısını çok iyi  anlamanı istiyorum.
ayrıca dosya isimleri ne örnekler şu şekildedir;

Her iki raporda da şayet dosyalar ilk defa gönderiliyor ise (CNT) 01 olacak ve Aynı içeriklere sahip rapor mükerrer olarak tekrar gönderilmesi istenirse bu çoğu zaman BTK tarafına eksik paket gitme durumunda isteniyor) eski dosyanın üzerine yazılmasının önüne geçmek için CNT her seferinde bir sayı artırılıyor.

IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_01.abn ( Sıkıştırılmış hali: IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_01.abn.gz )
IZMARBILISIM_701_ISS_ABONE_HAREKET_20240520223100_01.abn ( Sıkıştırılmış hali: IZMARBILISIM_701_ISS_ABONE_HAREKET_20240520223100_01.abn.gz )


IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_02.abn (BTK tarafından herhangi bir nedenle Dosyanın tekrar gönderilmesi talep edildiğinde CNT (Count): iki haneli kod birer arttırılarak iletilir. böylece eski dosyanın üzerine yazılmasının önüne geçilmiş olur)

IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_01.abn.gz (sıkıştırılmış hali)
IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_02.abn.gz (sıkıştırılmış hali) (BTK tarafından herhangi bir nedenle Dosyanın tekrar gönderilmesi talep edildiğinde CNT (Count): iki haneli kod birer arttırılarak iletilir. böylece eski dosyanın üzerine yazılmasının önüne geçilmiş olur)




Bir başka önemli hususta geçmiş çalışmalarımızda "ABONE REHBER" ve "ABONE HAREKET" dosyalarının içerikleri ve dosya formatına ilişkin zaman zaman yanlış kararlar almış olmandır.. bunun nedeni bu konuda seni tam aydınlatamamış olmam olsa gerek.. BTK'nın raporlarda ki ODAK Noktasın İşletmeci tarafından "HİZMET(LER)"; Bir abonenin birden fazla hizmeti olabilir (aynı adreste bile olsa) Ev, İş, Yazlık, Kışlık, Merkez, Şube veya depo, hatta aile bireylerinden bir başkasının adresine bile kendi adın İSS hizmeti alabilir.. böyle bir durumda her bir hizmet için ayrı ayrı kayıtlar oluşturulacaktır. böyle bir durumda  zaten sipariş öncesinde WHMCS admin panelindeki "clients profile" sayfası üzerinden ihtiyaç duyulan verilerin girişini sağlanmış olduğundan Whmcs "orders add" Ürün/Hizmet Sipariş Ekranında "Yerleşke Adresi ile Tesis Adresi Aynı" seçim kutucuğu (bu kutucusuk defauld olarak seçili gelsin bunun nedeni ise abone potansiyeli genelde ev kullanıcılarından oluşuyor.) ilave edilsin ve siparişi gönder tuşuna basılması ile birlikte WHMCS "clients services" alanına hooks yardımı ile oluşturduğumuz alanlara otomatik yazsın. bu kutucuk işaretli olmaz isen siparişi gönder tuşuna bastıktan sonra (normalde sipariş onayına gider iken) WHMCS admin panelindeki "clients services" sayfası yönlenmesini sağlanacak.. ve ihtiyaç duyululan verilerin girişini sağlamak için Modülün service_details.tpl sayfasının enjekte edilmesi sağlanacak. son aşamada WHMCS admin "clients services" sayfasının alt kısmındaki "Değişiklikleri Kaydet" butonu ile gerekli bilgilerin "whmcs'nin ilgili alanlarına ve BTK Modülüne ait (SQL) alanlara kaydı sağlandıktan hemen sonra (bu aşamaya kadar sipariş onayında bekliyor olan hizmetler için) yine "clients services" ekranında ki "Değişiklikleri Kaydet" butonunu hemen yanına bu sefer "Siparişi onayla" tuşu otomatik gelsin..  şayet bu tuşu getirme kabiliyeti yok ise ilgili hizmetin (orders.php?action=view&id=xxx) sipariş onay ekranına gidilsin. Tüm bu aşamalara kadar BTK için gerekli Tüm "ABONE REHBER" ve "ABONE HAREKET" için ihtiyaç duyulan tüm verilerin Büyük bir kısmı MODÜLÜN SQL TABLOSUNDA, Bir Kısmı ise ilgili WHMCS SQL Tablolarında Oluşmuş olacaktır. "Siparişi Onayla" Tuşuna  basıldığı an  "ABONE REHBER" ve "ABONE HAREKET" dosyalarına (314_KK_Abone_Desen.pdf Teknik dokumanda ifade  edilen kurallara uygun bir şekilde) "YENI ABONELIK KAYDI" oluşturulur. burada dikkat edilecek husus Bir Aboneye veya Hizmete ait veriler daha önceden bir başkaca tablolara kayıt edilmeli  ki "ABONE REHBER" ve "ABONE HAREKET" dosya içerikleri  "siparişi onayla" tuşuna basılması ile oralardan çekilmeli ya temp bölümünde (ki bu veri kaybına yol açabilir diye düşünüyorum) en sağlıklısı "ABONE REHBER" ve "ABONE HAREKET" dosya içeriklerinin tamamını barındıran örneğin "mod_btk_abone_rehber.sql" ve "mod_btk_abone_hareket.sql" tablolarına anlık olarak işlensin. Modül içindeki BTK Abone Veri Raporlama sayfasından (generate.tpl) yapılan işlemlerde Mevcut hiç bir veriyi silmeden rapor oluşturma ve gönderme işlemleri yapılır iken verilerin içeriği ve daha önce (manuel veya cron ile) gönderilip gönderilmediği kontrol edilerek şayet aynı verileri içeren bir rapor daha önce oluşturulmuş, ftp klasörüne yüklenmiş ise (bunun içince bir sql tablo gerekebilir dosyaların adlarının ve ftpye yükleme tarihlerinin ve aynı içerikli dosyanın kaç sefer gönderildiğini bir tabloda tutmak gerekir) daha sonraki aynı içerikteki mükerrer dosyalar, ilk oluşan dosyaların ismi aynen alacak ancak aynı içerikteki dosyanın kaç sefer oluşturulduğu ve ftpye yüklendiğini bilgisi de bir sql tabloda tutulmalı ki 314_KK_Abone_Desen.pdf  Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak iletilir. Talimatları doğrultusunda; CNT (Count) oluşturulsun." burada önemli husus içeriklerin aynı olması durumudur. içeriklerin farklı olması halinde yeni bir dosya ismi ile yeni bir dosya oluşturulur.

bu arada config bölümüne ftp bilgilerinin yer aldığı ekranın hemen alt kısmına hangi dosyanın hangi zaman aralıklarında ve hangi saatte ftp sunucuna yükleneceğine dair cron çalışma zamanlamasına ait bölüm eklesin.
"ABONE REHBER" dosyasının gönderim zamanı defauld olarak "her ayın ilk günü saat 10:00" ve "ABONE HAREKET" dosyasının gönderim zamanı defauld olarak "her gün saat 01:00" olmalı ancak BTK'dan gelecek yeni talimatlar dosyasında bu cronların zamanlamalarına ilişkin değişikliğin bir kod değişikliğine ihtiyaç duymadan ekrandan ilgili personel tarafından değişiklik yapılabilmeli.

"ABONE REHBER" tablosunda oluşan hiç bir verinin, hiç bir şekilde ( Abone sözleşmesi, veya iptali durumunda dahi) silinmesi söz konusu dahil olamaz.
Ayrıca Hizmet veya Ürünün İPTAL bilgisi girildiği an  "ABONE REHBER" dosyasına "IPTAL" işlemlerine dair son güncelleme yapılırken aynı anda ve "ABONE HAREKET" dosyası son kez "IPTAL" işlemine ilişkin satır oluşturulur.
Hakkında "IPTAL" İşlemi yapılan "ÜRÜN/HİZMETLERİN" WHMCS sistemi içindeki herhangi bölümde Hizmete dair bilgilerin değiştirimesine edilmesi engellenmeli.
Hakkında "IPTAL" İşlemi yapılan "ÜRÜN/HİZMETLERİN" WHMCS sistemi içindeki herhangi bölümde Hizmetin tekrar aktif edilmesi engellenmeli.
Ayrıca (Sonradan İPTAL edilmiş Bile olsa..)  ONAYLANMIŞ Hiç bir Hizmetin SİLİNMESİNE DE İZİN VERİLMEMELİDİR!

BTK'nın yetki iptal sebebi sayabileceği kadar önemli olan bu konularda hassasiyet göstermeni Bireysel Abonelerde "Abone Numarası, TCKN, Ad Soyad" Kurumsal Abonelerde ise "Abone Numarası, UNVAN, MERSİS NO" gibi değiştirilmesi hayatın doğal akışına aykırı olan verilerin hiç bir şekilde değiştirilmesine veya silinmesine izin verilmemelidir.
   
Nerede Kaldık :) "ABONE HAREKETLERİ" dosyası EVET her bir hareket için ayrı ayrı bir kayıt satırı oluşacak olsa da bazen özellikle geriye dönük hukuki süreçlerde "BORÇTAN KAPAMA veya IPTAL" gibi veya benzeri konularda mahkemelere dava ve delil konusu olacak bu raporlarda hayati derecede öneme sahip... EVET bu veriler FTP Sunucuna gönderiliyor ama "HER NE KADAR SUNUCUNUN MÜLKİYET HAKKI BİZE AİT BİLE OLSA.. HATTA FİZİKİ OLARAK KENDİ OFİSİMİZDE BARINDIRIYOR OLSAK BİLE.. SUNUCUNUN YÖNETİMİ BTK TEKNİK PERSONELİNE AİT" Bizler de sadedece O sunucunun belirli klasörlerine ilgili verileri yükleyebiliyoruz.. Sunucu içindeki bir ALGORİTMA İlgili Klasöre, İlgili Veri Doğru şekilde yüklendi mi önce onu analiz ediyor sonra sıkıştırılmış bile olsa ilgili verinin içeriğini satır satır kontrol ediyor örneğin AD, SOYAD ve TCKN uyumsuzluğu ve/veya NVİ ADRES KODU ile girilen Adres alanları doğrulanıyor mu diye içerik analizini de yaptıktan sonra şayet satırların herhangi bir hata ile karşılaşırsa bir hat log dosyası oluşturuyor şu abonenin TCKN'si doğrulanamadı gibi.. Hiç bir hata yok ise bu dosyayı sunucuda bizim erişimine hatta görmemize bile yetkimizin olmadığı başka bir klasöre otomatik olarak aktarılıyor.. artık o dosyaya bizim hiç bir şekilde erişimimiz kalmıyor. BTK RAPORLARI 5651 Sayılı katalog suçlarla mücadele kapsamında değerlendiriyor ancak bizimde hukuki süreçlerde geriye dönük bir şekilde bu verilerin zaman damgalı bir şekilde kayıt altında tutulması REHBER zaten hiç bir şekilde SİLİNMESİ SÖZ KONU BİLE OLAMAZ.. ama hareketlerin SQL veri tabanını şişireceği endişesi içerisindeyim. bu konuda senin önerin nedir?


btkreports_deactivate(): Modül devre dışı bırakıldığında çalışır SQL dosyaların silinip silinmeyeceğine ilişkin zaten config ekranında bir seçim kutucuğu var. aynı uygulama devam etsin.

Genel Ayarlar:
Operatör Kodu (Text, BTK Teknik ekibi tarafından sözlü olarak bildirilir)
Operatör Adı (Text, BTK Teknik ekibi tarafından sözlü olarak bildirilir) 

Bu bilgilerin sözlü olarak aktarıldığı ve geçmiş dönemlerde SİZİN OPERATÖR ADINI IZMAR değil IZMARBILISIM olacaktı gibi olayların da yaşandığı düşünecek olursa sabit readonly olmasındansa config ekranından yönetilebilir olması daha doğru olacaktır.
Hiç bir aksilik olmasa bile işletmemiz zaman içinde belki de Ticari UNVANINI Değiştirme cihetine gidebilir böyle bir olayda OPERATÖR KODU VE OPERATÖR ADI da değişmesi sözkonusu olacaktır.
Ve modülümüzün ESNEK GELİŞİME AÇIK OLMA İlkelesine de ters düşecektir.

ANCAK DEĞİŞTİRELEMEZ BİLGİLER OLARAK READONLY OLABİLECEK VERİLERDE VAR ÖZELLİKLE BİREYSEL VEYA KURUMSAL ABONE Bilgilerindeki değiştirilmesi doğanın akışına ters olan doğumdam ölüme değişmesi mümkün olmayan veriler için söz konusu olsun 


tekrar özet geçecek olursak;

öncelikle ben türküm ve modülü kullanacak personeller de türk onun için iyi derecede türkçe öğrenmelisin :)

Tüm proje boyunca ALTIN KURAL olarak uygulamanı istiyorum! Tüm dosyalar sanki ilk versiyonmuş gibi eksiksiz ve tam olarak göndermeni istiyorum  (ara sürüm güncelleme dosyası olarak değil) Tam sürüm dosyası olarak TAM VE EKSİKSİZ UNUTMA BU ALTIN KURAL!
Proje boyunca bana iş yüklemeyeceksin. tüm projenin hata ayıklama veya geliştirme aşamalarında ben sadece testter olarak katıkı sunacak ve sana sonuçlar hakkında geri dönüşler sağlayacağım.


FTP SUNUCULARA İLİŞKİN:
Projede neden iki ayrı ftp sunucuna ihtiyaç duyduğumuz aklına takılmıştır. Öncelikle ANA FTP (BTK FTP SUNUCUSU) Mülkiyeti bize ait olsa da hatta fiziki sunucunun bize ait veri merkezinde olmasına rağmen, yönetimi tamamen BTK teknik Personeli tarafından yapılmaktadır. Biz BTK FTP SUNUCUSUNUN İlgili Klasörüne ilgili dosyayı attıktan sonra BTK FTP SUNUCUSU içinde bir algoritma dosyanın önce dosya formatını, sonrada dosya içeriğini inceliyor eğer veride bir hata veya eksiklik yok ise.. yine aynı sunucunun içinde ama bizim erişim yetkimizin olmadığı olmadığı bir klasöre kaldırılıyor. Şayet ilgili dosyada bir eksiklik veya hata bulunursa hangi abone ve/ya hizmetlerde hata veya eksiklik olduğunu anlatan bir hata dokumanı oluşturuyor ancak her iki aşamada da bizim göndermiş olduğumuz dosya(ları) yine bizim erişimimize kısıtlı olan bilmediğimiz bir başka klasöre taşınıyor. BTK Bu verileri 5651 Sayılı Kanun Kapsamında Sorumlu olduğu katalog suçlarla ilgili mücadele kapsamında bizlerden istiyor ancak bizler de de (başka bir fiziki FTP sunucuda) bir yedeğinin olması böylece gönderimde veya ilerdeki sakla sürecinde oluşacak disk veya başka sorunlarda oluşacak veri kaybının önüne geçmek istiyoruz. Bir başka amacımızda BTK 5651 kapsamında bu verileri saklarken bizde ileride herhangi bir abonemizde hukuksal bir anlaşmazlık yaşadığımızda (Borç İlişkisi veya Hizmet Alıp almadığı gibi... ) Konularda  ilerde yaşanabilecek mahkeme süreçlerine dayanacak olabilecek şekilde zaman damgalı şekilde arşivlemek istiyoruz. bu arsivi SQL Tablolar içinde canlı veri olarak tutmak bir süreliğine mümkün olsa da zaman içinde SQL veri tabanı şişecektir. SQL veritabanı yönetilemez hale gelecek ve sistem ağırlaşacaktır. o yüzden ikinci bir FTP (YEDEK) SUNUCU tanımlama ekranı için alan açmanın en azından seçenek olarak sunulmasını.. (Yedek FTP Sunucusu Kullanmak istiyorum Evet/Hayır) seçim kutucuğu default olarak "Hayır" olsun ancak Evet seçildiği an daha önce sadece FTP (BTK) Sunucunun Bilgileri görünüyor iken.. Aynı ekranda en uygun yere YEDEK FTP SUNUCU Bilgilerine dair verilerin girileceğin alanlar SEÇİM YAPILINCA OTOMATİK BELİRSİN. Ne düşünüyorsun? yapalım mı? 
ayrıca BTK FTP SUNUCUSUNDA Oluşan dosya hatalarına ilişkin verilerden söz etmiştim sana.. projenin ilerleyen aşamalarında (FİNALE YAKIN BİR ZAMANDA OLABİLİR) Bu hata dosyalarını (bad_REHBER_202311061155.gz veya hata_ozet_REHBER_202311061155.gz gibi) içeriklerini okuyup bizim loglarımıza yazmayı hatta mümkünse ekrana filanca abone veya ürün bilgisinde hata var diye uyarı getirebilmesini hedefleyelim ne dersin? 


Rapor dosyalarına ilişkin detaylar:

daha önceki modül çalışmalarımızda oluşturulan dosyaların uzantı veya adların teknik dokumandan farklı bir durumla karşılaşmıştım. tekrar belirtmekte fayda var; senden fark ettin mi dosya isminin tamamı BÜYÜK HARF iken, uzantılar ".abn" ve ".gz" görüldüğü gibi küçük harf olarak belirlenmiş buna dikkat etmekte fayda var birincisi bu dosyalar yüklenildiği an BTK tarafında ki ftp sunucularda da bir dosya adı ve içeriğini dair denetim algoritması var.. buna takılmak istemiyorum. Diğer bir konuda da olurda dosya sorun çıkarmasa bile BTK TEKNİK Personeli biz senden böylemi istedik demesin :)

Örnek dosya isimi:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn” 

SIKIŞTIRILMIŞ OLARAK FTP SUNUCUNA GÖNDERİLENLERE DOSYALARA ÖRNEK:

“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn.gz”




Raporlama Kolaylığı: Cron job çalıştığında, FTP'ye gönderilecek ABONE REHBER ve ABONE HAREKET dosyaları doğrudan bu SQL tablolarından sorgulanarak oluşturulur. Hareket dosyası oluşturulduktan sonra, gönderilen hareketler mod_btk_abone_hareket tablosundan silinebilir veya "gönderildi" olarak işaretlenebilir. önergesini daha da netlik katalım.

ABONE REHBER tablosundaki hiç bir verinin zaten silinmesi söz konusu olmayacak (aboneye dair hizmet iptal olsa dahi hatta abone ölse , şirket ise batsa dahi) onlara ait REHBER dosyasındaki hiç bir veri silinmeyecek.. SON defa bir IPTAL güncellemesi yapılacak. Sebebi ve TÜRÜ ne olursa olsun İPTAL işlemi yapılan bu hizmet hiç bir şekilde bir daha aktif edilmemeli ancak WHMCS burada biraz farklı davranıyor İPTAL edilmiş bir hizmet WHMCS clients services ekranından yine durumu aktif edilebiliyor bunun kesinlikle önüne geçmeliyiz. İPTAL ÖLÜ DEMEKTİR.. ÖLÜ DİRİLMEZ HAKSIZ MIYIM?

bu arada ABONE HAREKET içinde aynı kurallar geçerli İPTAL olan bir hizmete dair SON kez İPTAL içerikli bir hareket satırılı oluşturulur. ve bir daha o hizmet asla hareket görmemeli! bunu senin de dediğin gibi SQL tabloda bayraklamak ile işaretlemek ile mümkün..

ayrıca ABONE HAREKET dosyası hakkında şöyle bir fikir birliğinize varmıştık..
ABONE HAREKET tablosu bir günde bile (şu an aktif abone sayısı 500 Olduğunu ve günde her abone günlük 10 hareket geliştirse desek ABONE HAREKET sadece bir günde 5000 satıra oluşacak..ve bu SQL tablosundan çekilecek BTK sunucuuna gönderilecek olan "ABONE HAREKET" dosyasının hazırlanma süresini geciktirecektir.. ABONE HAREKET dosyalarını her gün saat 01:00’da iletecek, abone hareket dosyaları bir önceki güne ait değişiklikler ile önceki gönderilen abone hareket dosyalarında iletilmeyen değişiklikleri içerecek olmasından anlaşılacağı üzere takriben günde en az 5000 satırlık (Her yeni abone ile bu daha artacak olan) bir tabloyu hem canlı verilerin çekildiği hem de uzun süreli bir arşiv tutmak çok akıllıca olmayacak diye karar verdik hatırlıyor musun?

onun için iki farklı "ABONE HAREKET" tablosu oluşturalım;
ilk ve canlı "ABONE HAREKET" tablosu: kaç günlük veriyi içereceğini (en az 2 günlük olmak kaydı ile)  modülün uygun sayfasında (Büyük ihtimal ile Raporlara ilişkin sayfayı biraz daha geliştirmemiz gerekecek) belireceğimiz süre aralığında ki tüm canlı (anlık) veriler tutulacak (niye en az 2 günlük.. BTK FTP sunucusuna gönderim yapıldıktan sonra aynı gün içinde oluşacak veriler BTK'nın tabiri ile gönderilemeyen hareketlerin 2. güne sarkabileceğini ön gördük.) (Niye sadece 2 güne sabitlemek yerine modül içinde bur süreyi istediğimiz gibi dinamik tutmalıyız:  Çünkü bazen BTK tarafındaki otomasyon dosya formlarını ve/veya içeriklerini kontrol etmekte gecikebiliyor... Böyle bir durumda şayet gönderdiğimiz dosya veya içeriği hatalı ise BTK o dosyaları yeniden gönder bize diyebiliyor.. bu ara bir dipnot daha: BTK' ya bir rapor içeriği ilk defa gidiyor ise ("ABONE REHBER" ve "ABONE HAREKET") için uygulanacak CNT formülünü hatırlıyorsun değil mi? işte bu aşamada bize  tabloda üç ayrı alanın daha gerekiyor;
ilk alan: BTK'ya gönderilen satırların işaretlenmesi senin tabirinle bayraklama işlemi için ihtiyacımız olacak.

ikinci alan : CNT (Count) Alanı : BTK'ya gönderilecek olan verilerin içeriklerin gönderilmesi esnasında belirnen dosya isimlerini oluşturan elementlerden birisi olan CNT sayısının tutulacağı alandır. bu alan veri ilk oluşturulur iken DEFAULT olarak (01) olmalıdır. BTK tarafından Aynı içeriğine sahip Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak. buradaki maksat dosyaların aynı isimler birbirlerinin üzerine kayıt edilmesinin önüne geçmek olabilir veya her iki dosyayı elde tutup doğrulamak için de olabilir.

üçüncü alan: İlgili verinin dahil edildiği BTK dosyanın adını içerecek alandır.
ÖRNEK : IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn

Şayet bu üç tabloyu oluşturmaz isek btk bir veriyi tekrar istediğinde içerik olarak aynı olsa da (dosya oluşturma algoritması arasında yer alan sistem tarihi, ve saati değişeceği için BTK bunu istemiyor. Gönderilen ilk dosya adı ile ama CNT bir artırılmış olarak gönderilmesi istenmektedir.

CNT (Count): Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak iletilir.

Örnek dosya isimi:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn” 

SIKIŞTIRILMIŞ OLARAK FTP SUNUCUNA GÖNDERİLENLERE DOSYALARA ÖRNEK:

“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn.gz” 

Dosya yapısı ve içeriğine ait bilgilerin tamamı zaten BTK TEKNİK 314_KK_Abone_Desen.pdf Dokümanında mevcut.. ben sana tekrar hatırlatmak istedim. 

ARŞİV "ABONE HAREKET" tablosu: Canlı (anlık) veri tablosunda ki verilerin (canlı tablodaki konaklama (bulundurulma süresi dolan verilerin) Arşivleneceği bir tablodur.
Bu arşivlemenin Kaç günlük veriyi içereceğini modülün uygun sayfasında (Büyük ihtimal ile Raporlara ilişkin sayfayı biraz daha geliştirmemiz gerekecek) belirlemeliyiz. Zaten BTK'ya (ANA FTP SUNUCUSUNA) gönderilen Her dosya aynı anda YEDEK FTP sunucuna gönderiliyor iken tekrar böyle arşivlemeye neden ihtiyaç duyuyoruz. Evet YEDEK FTP SUNUCUMUZDA bu verilerin tamamı saklanacak ancak bu öyle bir hale gelecek ki bu dosyaların kapsamı on yılları aşacak (şu an faaliyetimizin 12. yılındayız) olur da canlı verinin yaşam süresini aşan bir veriyi BTK talep edecek olursa en azından (SQL yapımızın kaldırabileceğin süre boyunca) 5-6 aylık süre ile bile olsa verilerin burada sistemin içinde (ARŞİV "ABONE HAREKET") tablosunda mevcut bir veri ise hemen bir dakika içinde BTK tarafından istenen verinin yeniden gönderilmesi sağlanabilecektir. CANLI tarafta ki tekrar gönderim aşamaları ve gerekli tablolar zaten aynı olacaktır.

ayrıca bir konuda bir ilave daha yapmamız gerekiyor;
Ola ki "ABONE HAREKET" ve/veya "ABONE HAREKET" verileri arasında  SQL tablolarda yaşam süresi doldurduğu için artık tabloda yer almayan bir veri veya veri kümesini BTK aradan yıllar geçse bile.. (Bu bilgilerin saklanma süresi MEVZUATTA 30YILDIR) şu isimli veya şu tarih aralığındaki "ABONE HAREKET", "ABONE HAREKET", "PERSONEL LİSTESİ" BTK'ya gönder talebi geldiğinde bu talebi otomatik olarak sağlayacak şekilde bir FTP YEDEK SUNUCUDAN GÖNDER başlığı altında bir alan olmalı bu alanda;

zaten modülün config ekranında tüm ilgili dosyalara ait FTP dosya yolları belli olduğu için aranacak yerler zaten belli.. YEDEK sunucudan çekilecek VERİNİN TÜRÜ bir drop menü ile çekilebilir ""ABONE HAREKET", "ABONE HAREKET", "PERSONEL LİSTESİ" ) türünden sonra iki search alanı olmanı birisi dosya ismi diğeri de verilen iki tarih arası aramada listenene dosya(lar) ekrana listenir ve yanlarında BTK'ya yeniden gönder sekmesi seçilerek işlem başlatılmışmış olur. burada süreç biraz daha farklı ilerleyecektir. Çağrılan sıkıştırılmış ".gz" dosyası ve onun içinde yer alan ".abn" dosyasının içeriğine hiç bir değişiklik yapılmayacak ancak tekrar gönderilen dosyaların adına ilişkin CNT bir artırılması kuralığı gereği sıkıştırılmış dosyanın içindeki ".abn" dosyası temp klasöründe ".gz" içinden çıkarılarak dosyanın adındaki CNT bir artırılarak yeniden ".gz" formatında sıkıştırılması sağlanmalı (".abn" dosya adı değiştiği için zaten ".gz" ismi de değişmiş olacak.. bu benim aklıma gelen olan bir yöntem başkaca teknikler de üretebiliriz.

Belki de BTK en başından "yeniden gönder" yapısının böyle kurgulanmasını istiyor olabilir... öyle bir durumda oturup yeniden modülü yeniden yazmak zorunda kalmayız... BTK nereden hangi metodla isterse o şekilde göndeririz :)







Şayet vefatı tespit edilebilecek bir seçenek yok ise Periyodik NVI doğrulamalarında, eğer bir TCKN artık doğrulanamıyorsa (ki bu vefat dışı sebeplerle de olabilir), bu son derece doğru bir tespit bu konuda ekranda ve ayrıca loglarda bir uyarı Şu aboneye ait TCKN artık geçersiz diye bir uyarı verilir ise ilgili personelin aboneye çeşitli iletişim araçları üzerinden erişmeye ve yaşayıp yaşamadığına teyit edilmesi ve bu teyit durumunda vefat işlemlerinin manuel başlatılması için bir seçenek ilave edilebilir. https://tckimlik.nvi.gov.tr/Home bu sayfayı derinlemesine bir incelemen gerekiyor

ayrıca en az TCKN no kadar önemli bir doğrulama da "ADRES KODU" doğrulaması bununla ilgili görüşmelerimizi hatırlıyor musun? https://adres.nvi.gov.tr/home Abone Yerleşke ve tesis adreslerinin  UAVT, "Ulusal Adres Veri Tabanı" doğrulanması ve UAVT Numarasının  doğru olarak girilmesi sağlanmalıdır. bir araştırma yapmalısın https://adres.nvi.gov.tr/VatandasIslemleri/AdresSorgu veya benzeri sitelere bizdeki adres bilgilerin enjekte ederek ADRES KODU'nu doğruyabilecek miyiz bir araştırma yapanı istiyorum


BTK mevzuatlarına göre bir abonenin (hizmet(leri) iptal edilse hatta abone vefat etse bile) "ABONE REHBER" yapısında bazı veriler hayatın doğal akışında da olduğu gibi "Bireysel abonelerde TCKN, Adı, Soyadı gibi.. ) "Kurumsal abonelerde Vergi Kodu ve Mersis Kodu gibi) hiç bir suretle değişmesi mümkün olmayan verilerin modül içinde de değişmesine veya silinmesine hiç bir şart altında izin verilmemesi gerekiyor.

Bu konuya ek olarak hatırlıyor musun NVİ üzerinden TCKN doğrulaması yaptırmamız gerekiyordu.. bu konuda bir araştırma yapmalısın bu kişilerin hayatta olup olmadığını.. şayet vetfat etmiş ise tüm hizmetlerinin BTK Teknik dokümanında ki VEFAT eden abonelere uygulanması istenen işlemlerin yapılmasını da sağlamalıyız. bu konuda iyi bir araştırma yapmalısın.  



modül temamızın genel prensibi modülü kullanacak olan personeli aynı zamanda özellikle BTK Usul ve mevzuatları noktasında küçük bilgi notları sayesinde eğitmektir. modülün gerekli tüm ilgili alanlarına özellikle veri giriş alanlarının yanına yakınına (i) info simgesi eklemeni kliklemeye gerek kalmadan, ilgili info simgesinin üzerine gidildiğinde ufak ta olsa bir bilgilendirme balonu açılmasını istiyorum. bu talebimi hatırlıyor musun?

bu ufak bilgi notlarını hazırlayabilmek için BTK web sayfalarından yararlanabilirisin.
Bu modül resmi bir Devlet kurumu olan BTK trafından yetkilendirilmiş olduğumuz konularda sunduğumuz hizmetlere İlişkin; "ABONE REHBER", "ABONE HAREKET" ve "PERSONEL BİLGİLERİNE"  verilerin, yine BTK tarafından sağlanan TEKNİK DÖKÜMANDA (314_KK_Abone_Desen.pdf) istenildiği şekilde göndermek üzerine olduğu için aşağıda linklerini verdiğim adreslerden tüm ilgili mevzuatlar öğrenmeni istiyorum.

BTK'nın bu göndereceğim bilgilerde usulsüzce bir değişikliğe karşı hiç bir şekilde taviz vermediğini daha net anlaman için sana bir de ceza kararı göndereceğim

https://www.btk.gov.tr/kanunlar

https://www.btk.gov.tr/bakanlar-kurulu-kararlari

https://www.btk.gov.tr/yonetmelikler

https://www.btk.gov.tr/tebligler

https://www.btk.gov.tr/kurul-kararlari (özellikle ceza ve idari yaptırım kararlarını iyi öğrenmelisin ki bizde aynı hatalara düşmeyeleyim)



Burada bir önemli konu daha var;

Personel Listesi:
PERSONEL LİSTESİ (aslında bu veri daha önce BTK' ya e-posta aracılığı ile gönderiliyordu birazda kişisel veri mahremiyetini gözetmek için FTP sunucuna bırakın denildi) dolayısı ile oraya 6 Ayda bir gönderilecek dosya hep aynı isimde olacak "Personel_Listesi.xlsx"

Ancak bu YEDEK FTP yapısında (arşivleme yapılacağı için) baz değişiklikler yapmak zorundayız.
örneğin:
Personel_Listesi_2024-1.xlsx
Personel_Listesi_2024-2.xlsx 

EXCELL dosyasının adı Ait olduğu yıl ve gönderilme dönemi veya gönderildiği ay bilgi de eklenerek farklılaştırılmalı böylece dosyalar birbirlerinin üzerine yazılmazlar. bu arada belki de BTK' da gönderimin böyle olmasını istiyordur.
PERSONEL ekranında dosyayı gönderim ekranında dosya adına "YIL-AY" ilave edilsin diye bir seçenek ekleyelim.
Bu her iki FTP (ANA ve YEDEK) sunucu içinde ayrı ayrı sorulsun. böylece hem biz YEDEK FTP Yedek sunucunda dosyaları üst üste yazılmasının önüne geçerek arşivleme yapmış olacağız hem de günün birinde BTK Teknik Uzmanları da dosyaların üzerine yazmayı farklılaştırın dediklerinde bir daha modül yazma derdine düşmeyiz.  


https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/Personel_Listesi.xlsx
btkya gönderilecek excell dosyası oluşturulacak. ancak excelde olmayan alanlar şimdiden kendi İK yapımızın oluşması için bize veri sağlayacaktır.

EV ADRESİ (BTK için olmasa da İK için, manuel giriş)
ACİL DURUMDA ARANACAK KİŞİ VE İLETİŞİM BİLGİLERİ (BTK için olmasa da İK için, manuel giriş)
İŞE BAŞLAMA TARİHİ (BTK için olmasa da İK için, manuel giriş)
İŞTEN AYRILMA TARİHİ (BTK için, Excel'de sadece mevcut çalışanlar listelenecek, manuel giriş)
İŞ BIRAKMA NEDENİ (BTK için olmasa da İK için, manuel giriş) 

Yukardaki alanlar Bizim Kendi İK yapımız için gerekli olacaktır.

BTK LİSTESİNE EKLENSİN (Checkbox, API kullanıcıları gibi kayıtların hariç tutulması için) bu alan ise hatırlıyorsan veri girişi iki şekilde oluşacak. ilki daha modül kurulur iken whmcs yöneticiler (config admins) bölümündeki mevcut olanları modüllümüzün personel bölümüne otomatik olarak çekecek ancak bunlardan bazı (insan olmaya) banka posları veya robotic müşteri temsilcisi v.b. otomasyon API yapılarını yönetmek için tanımlanmış hesaplardır. onları BTK raporundan uzak tutmak için BTK LİSTESİNE EKLENSİN (Checkbox, API kullanıcıları gibi kayıtların hariç tutulması için) yapısına ihtiyacımız var. eksik kaldığım veya unuttuğum bir şey varsa sen tamamla lütfen.. fikrin nedir?

WHMCS admin panelindeki "clients profile" sayfası üzerinden ihtiyaç duyululan verilerin girişini sağlamak için Modülün client_details.tpl sayfasının enjekte edilmesi sağlanacak.
WHMCS admin panelindeki "clients services" sayfası üzerinden ihtiyaç duyululan verilerin girişini sağlamak için Modülün service_details.tpl sayfasının enjekte edilmesi sağlanacak.
WHMCS aynı bilgilerin Müşteri panelindeki Kişisel bilgilerinin ve Hizmetlere ilişkin detay bilgilerin (değiştirilemez şekilde..) görüntülenmesini sağlayacak modülün "client" kodlarının ilave edilmesi sağlanacak.



projeyi biraz daha geliştirelim mi?
BTK raporları arasında yer alan (yetkilendirme konusu İSS kapsamında olan hizmetler için)  "ISS POP BILGISI" hatırlıyorsun değil mi?

bu alan "clients services" ekranındaki hizmete ait sunucu bilgisinden alıyorduk doğru mu?

ancak "314_KK_Abone_Desen.pdf"  teknik dokümanında istenin bilgi sadece sunucu olarak tanımlanan  "ISS POP BILGISI"  yetersiz kalıyor. POP bilgisi aslında  sunucu bilgisinin yanı sıra abonenin bağlı olduğu "BAZ İSTASYON" veya bağlı olduğu "SANTRAL" bilgisinin de eklenilmesi gerekiyor. Ayrıca ek olarak süreli bir döngüsü olmasa da zaman zaman BTK tarafından SANTRAL veya BAZ İSTASYON bilgilerinin (Resmi Evrak ile) istenebiliyor.

Her iki talebi de karşılayabilmek için ek olarak "ISS POP NOKTASI" içeren sql tablosuna ihtiyaç duyulacaktır.
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/iss_pop_nokta_listesi.xlsx excel  dosyasındaki bilgilerin girişini sağlayabilecek yeni bir sayfaya ihtiyacımız olacak. buraya bilgileri manuel olarak girilebildiği gibi bir excel dosyası üzerinden import ve export işlemi de yapılabilmeli böylece BTK pop bilgilerini talep ettiğinde hızlıca güncel bir excel tablosuna kavuşmuş olacağız

BTK raporarında kullanılmak için ihtiyac duyulan (ISS POP BILGISI) alanı için ise;
İlgili hizmete ait "clients services" ekranındaki sunucu bilgisinin olduğu en yakın ve en uygun yere enjekte edilmek üzere "ISS POP NOKTASI" tablosundaki  "YAYIN YAPILAN SSID" alanındaki (Hizmete ait "TESİS ADRES İLÇE adresi ile eşleşmesi koşulu ile) veriler drop menuler ile çağrılarak bu sayfa üzerinden girişi sağlanacak böylece ISS POP BILGISI alana ait veri şu şekilde oluşacaktır: "clients services" ekranındaki sunucu ve YAYIN YAPILAN SSID

ISS POP BILGISI: SUNUCU.YAYIN YAPILAN SSID

Şayet  "clients services" ekranındaki drop menu de bir "YAYIN YAPILAN SSID" verisi seçilmedi ise o vakit sadece SUNUCU yeterli olacaktır. "YAYIN YAPILAN SSID" alanı zorunlu alan değildir.
Dropdown'daki "Yayın Yapılan SSID" listesi çok uzun olabilir. İlçe filtresi iyi bir başlangıç ancak bu filtrelemeyi kod içinde değil de en uygun hangi ekrana olur bilmiyorum ama bizim seçebileceğim bir alan olsa iyi olmaz mı "TESİS ADRES İL", "TESİS ADRES İLÇE", "TESİS ADRES MAHALLE" üç opsiyonu bazen kullanmak zorunda kalabiliriz örneğin bazen birbirlerine çok yakın sınır ilçelerin santrali üzerinden diğer ilçedeki bir aboneye de hizmet verebiliyoruz... ek olarak tamam yukardaki üç opsiyondan birini seçebileceğim bir alan koyduk ancak drop menü alanına tıkladığında veya senin tavsiye edebileceğin başka bir yöntemle drop alanını sanki bir search arama alanınymış gibi zaten teknik ekip tarafından aboneyi hangi istasyona bağladıklarına dair gelecek olan bilgiyi girerek hatta girdikçe drop alanında eşleşenlerin ekrana geldiğini ve nihayet abone hizmetinin sağlandığı cihazın "Yayın Yapılan SSID" gelmesi sağlanır. bu veriyi elle girmekten bahsetmiyorum elle girmek klavye ve insan hatasından kaynaklı yanlı bir "Yayın Yapılan SSID" giriş riskini doğurur. 

iltreleme Kriteri Seçimi (Opsiyonel - clients services ekranında):
"Yayın Yapılan SSID (POP Noktası)" dropdown'ının hemen üstüne veya yanına, kullanıcıya POP noktası listesini nasıl filtrelemek istediğini soran bir başka küçük dropdown veya radio button grubu eklenir iken default seçenek olarak en küçük veri kümesi olan "TESİS ADRESİ MAHALLE" olsun böylece dropdown en küçük veri kümesi ile hızlı bir başlangıç yapar. gerek duyarsa ilgili personel il veya ile olarak değiştirebilir. Ama bu değişiklik sadece ilgili hizmet için geçerli olacaktır. Bir sonraki bir başkaca yeni bir hizmet için yine defauld "TESİS ADRESİ MAHALLE" olacaktır.

"TESİS ADRESİ MAHALLE" bilgisinin hem müşteri hizmet detaylarında hem de mod_btk_iss_pop_noktalari tablosunda tutarlı bir şekilde mevcut ve eşleştirilebilir olması önemlidir. Zaten elimizde bir İL, İLÇE ve MAHALLE tablosu ve bunlar arasında ilişkilendirmelerin yapıldığı bir adres tablolarımız yok mu? oradan önce "TESİS ADRESİ İL" seçilir, seçilen İL'e ait "TESİS ADRESİ İLÇE" gelir, Seçilen İLÇE'den sonra "TESİS ADRESİ MAHALLE" otomatik gelecektir. zaten   clients services ekranındaki TESİS adres bilgileri aynı yöntem ve aynı tablolar üzerinden çekileceği için EŞLEŞMEME sorunumuz ortadan kalkacaktır.




Daha önce Birlikte yazdığımız bir projede hata ayıklama etabını da birlikte yürütelim istiyorum.

karşılaştığımız bazı sorunlar oldu ama aşamayacağımız şeyler değil..
Şayet Yardımcı Olmak istersen bu projeye ait tüm kodları ve bu güne kadar ki tüm sürece ait dökümantasyon linkleri:

projeyi sana aktarabilmek için github üzerine yükledim ancak proje CANLI BİR PROJE BİR SUNUCUDA HOST EDİLİYOR.



porojeye ait kütüphane:
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/

projenin son durumu:
https://github.com/kablosuzonline/WHMS-BTK-MODUL/tree/main/debug-2

porojeye ait son durum raporu:
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/MODUL-RAPOR.docx

başlamadan önce mevcut sistem altyapısı hakkında bilgi vermek istiyorum;



öncelikle ben türküm ve modülü kullanacak personeller de türk onun için iyi derecede türkçe öğrenmelisin :)

ALTIN KURAL: Projenin herhangi bir aşamasında Senden istediğim veya sunduğun hiç bir dosya (şunu şu dosyanın içine ekle) gibi derleme ve geliştirme (hata ayıklama dahil) hiç bir işi bana bırakmadan kendin çözecek ve bana sanki o dosyayı bana ilk defa veriyormuşcasına TAM SÜRÜM (EKSİKSİZ, NOKSANSIZ, TAMAMINI ve Mümkünse KUSURSUZ) olarak sunmanı istiyorum. Ayrıca Bbana sunacağın hiç bir dosya içeriğini  (daha önceki version, derleme veya benzeri ) dosyanın eski hallerine (Önceki gönderimdeki gibi, benzeri ifadeler ile) ATIFTA BULUNMAYACAKSIN! Bunu dosya içeriğinin büyüklüğünden yapıyorsan bu yöntem yerine dosyaları (içeriklerini) 150-200 satırlık bölümler halinde gönderebilirsin. yeter ki TAM SÜRÜM (EKSİKSİZ, NOKSANSIZ, TAMAMINI ve Mümkünse KUSURSUZ)  olarak bana gönder.
Tüm proje boyunca ALTIN KURAL olarak uygulamanı istiyorum! Tüm dosyalar sanki ilk versiyonmuş gibi eksiksiz ve tam olarak göndermeni istiyorum  (ara sürüm güncelleme dosyası olarak değil) Tam sürüm dosyası olarak TAM VE EKSİKSİZ UNUTMA BU ALTIN KURAL!
Proje boyunca bana iş yüklemeyeceksin. tüm projenin hata ayıklama veya geliştirme aşamalarında ben sadece testter olarak katıkı sunacak ve sana sonuçlar hakkında geri dönüşler sağlayacağım.
ALTIN KURAL'ımız:

TAM SÜRÜM İlkesi: Benden istediğiniz veya benim size sunduğum her dosya, sanki o an projenin ilk ve tek versiyonuymuş gibi, o dosyanın TAMAMINI, EKSİKSİZ ve NOKSANSIZ bir şekilde içerecektir. Hiçbir "şunu şuraya ekle", "burayı böyle değiştir" gibi derleme veya tamamlama işi size bırakılmayacaktır.

ATIF YOK İlkesi: Size sunacağım dosya içeriklerinde, dosyanın eski hallerine, daha önceki versiyonlara veya derlemelere ("bir önceki gönderimdeki gibi", "daha önce konuştuğumuz gibi" vb.) KESİNLİKLE ATIFTA BULUNULMAYACAKTIR. Her dosya, kendi başına, o anki en güncel ve tam halini yansıtacaktır.

BÖLÜMLEME İlkesi (Gerekirse): Eğer bir dosyanın içeriği çok büyükse ve mesaj limitlerini aşıyorsa, bu dosyayı size 150-200 satırlık (veya uygun mantıksal) bölümler halinde, her bölümün bir öncekinin devamı olduğunu net bir şekilde belirterek sunacağım. Ancak her bölüm, birleştirildiğinde yine dosyanın o anki TAM ve EKSİKSİZ halini oluşturacaktır.
KUSURSUZLUK Hedefi: Elbette, hedefim her zaman size olabildiğince hatasız ve düzgün çalışan bir kod sunmak olacaktır.
Dosya boyutu büyük olduğu için parçalar halinde göndermek zorunda kalacağın dosyalarda bölme işlemini yaparken;

1/X kuralı ile gönderebileceğin satır sayısına göre dosyayı kaç parçaya böleceğini otomatik olarak belirlemelisin.

özellikle göndereceğin php kodlarının sadece ilk satırında "<?php" ve sadece son satırında   "?>" kodları bulunsun. Asla modülün ARA PARÇALARINDA, ARA BÖLÜMLERİNDE PHP kod başı, kod sonu işaretleri olmayacak!
dosyaları birleştirme aşamasında her bir bölümde "<?php" ve/veya "?>" işateri olursa kod yapısını bozuyor hataya neden oluyor.
Parçaların eksiksiz gönderildiğini anlayabilmem için yorum satırları ekleyebilirsin ancak bu satırlarda PHP, TPL, SQL kod yapısına uygun olmalıdır.




FTP SUNUCULARA İLİŞKİN:
Projede neden iki ayrı ftp sunucuna ihtiyaç duyduğumuz aklına takılmıştır. Öncelikle ANA FTP (BTK FTP SUNUCUSU) Mülkiyeti bize ait olsa da hatta fiziki sunucunun bize ait veri merkezinde olmasına rağmen, yönetimi tamamen BTK teknik Personeli tarafından yapılmaktadır. Biz BTK FTP SUNUCUSUNUN İlgili Klasörüne ilgili dosyayı attıktan sonra BTK FTP SUNUCUSU içinde bir algoritma dosyanın önce dosya formatını, sonrada dosya içeriğini inceliyor eğer veride bir hata veya eksiklik yok ise.. yine aynı sunucunun içinde ama bizim erişim yetkimizin olmadığı olmadığı bir klasöre kaldırılıyor. Şayet ilgili dosyada bir eksiklik veya hata bulunursa hangi abone ve/ya hizmetlerde hata veya eksiklik olduğunu anlatan bir hata dokumanı oluşturuyor ancak her iki aşamada da bizim göndermiş olduğumuz dosya(ları) yine bizim erişimimize kısıtlı olan bilmediğimiz bir başka klasöre taşınıyor. BTK Bu verileri 5651 Sayılı Kanun Kapsamında Sorumlu olduğu katalog suçlarla ilgili mücadele kapsamında bizlerden istiyor ancak bizler de de (başka bir fiziki FTP sunucuda) bir yedeğinin olması böylece gönderimde veya ilerdeki sakla sürecinde oluşacak disk veya başka sorunlarda oluşacak veri kaybının önüne geçmek istiyoruz. Bir başka amacımızda BTK 5651 kapsamında bu verileri saklarken bizde ileride herhangi bir abonemizde hukuksal bir anlaşmazlık yaşadığımızda (Borç İlişkisi veya Hizmet Alıp almadığı gibi... ) Konularda  ilerde yaşanabilecek mahkeme süreçlerine dayanacak olabilecek şekilde zaman damgalı şekilde arşivlemek istiyoruz. bu arsivi SQL Tablolar içinde canlı veri olarak tutmak bir süreliğine mümkün olsa da zaman içinde SQL veri tabanı şişecektir. SQL veritabanı yönetilemez hale gelecek ve sistem ağırlaşacaktır. o yüzden ikinci bir FTP (YEDEK) SUNUCU tanımlama ekranı için alan açmanın en azından seçenek olarak sunulmasını.. (Yedek FTP Sunucusu Kullanmak istiyorum Evet/Hayır) seçim kutucuğu default olarak "Hayır" olsun ancak Evet seçildiği an daha önce sadece FTP (BTK) Sunucunun Bilgileri görünüyor iken.. Aynı ekranda en uygun yere YEDEK FTP SUNUCU Bilgilerine dair verilerin girileceğin alanlar SEÇİM YAPILINCA OTOMATİK BELİRSİN. Ne düşünüyorsun? yapalım mı?
ayrıca BTK FTP SUNUCUSUNDA Oluşan dosya hatalarına ilişkin verilerden söz etmiştim sana.. projenin ilerleyen aşamalarında (FİNALE YAKIN BİR ZAMANDA OLABİLİR) Bu hata dosyalarını (bad_REHBER_202311061155.gz veya hata_ozet_REHBER_202311061155.gz gibi) içeriklerini okuyup bizim loglarımıza yazmayı hatta mümkünse ekrana filanca abone veya ürün bilgisinde hata var diye uyarı getirebilmesini hedefleyelim ne dersin?

Rapor dosyalarına ilişkin detaylar:
daha önceki modül çalışmalarımızda oluşturulan dosyaların uzantı veya adların teknik dokumandan farklı bir durumla karşılaşmıştım. tekrar belirtmekte fayda var; senden fark ettin mi dosya isminin tamamı BÜYÜK HARF iken, uzantılar ".abn" ve ".gz" görüldüğü gibi küçük harf olarak belirlenmiş buna dikkat etmekte fayda var birincisi bu dosyalar yüklenildiği an BTK tarafında ki ftp sunucularda da bir dosya adı ve içeriğini dair denetim algoritması var.. buna takılmak istemiyorum. Diğer bir konuda da olurda dosya sorun çıkarmasa bile BTK TEKNİK Personeli biz senden böylemi istedik demesin :)
Örnek dosya isimi:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn”
SIKIŞTIRILMIŞ OLARAK FTP SUNUCUNA GÖNDERİLENLERE DOSYALARA ÖRNEK:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn.gz”

Raporlama Kolaylığı: Cron job çalıştığında, FTP'ye gönderilecek ABONE REHBER ve ABONE HAREKET dosyaları doğrudan bu SQL tablolarından sorgulanarak oluşturulur. Hareket dosyası oluşturulduktan sonra, gönderilen hareketler mod_btk_abone_hareket tablosundan silinebilir veya "gönderildi" olarak işaretlenebilir. önergesini daha da netlik katalım.
ABONE REHBER tablosundaki hiç bir verinin zaten silinmesi söz konusu olmayacak (aboneye dair hizmet iptal olsa dahi hatta abone ölse , şirket ise batsa dahi) onlara ait REHBER dosyasındaki hiç bir veri silinmeyecek.. SON defa bir IPTAL güncellemesi yapılacak. Sebebi ve TÜRÜ ne olursa olsun İPTAL işlemi yapılan bu hizmet hiç bir şekilde bir daha aktif edilmemeli ancak WHMCS burada biraz farklı davranıyor İPTAL edilmiş bir hizmet WHMCS clients services ekranından yine durumu aktif edilebiliyor bunun kesinlikle önüne geçmeliyiz. İPTAL ÖLÜ DEMEKTİR.. ÖLÜ DİRİLMEZ HAKSIZ MIYIM?
bu arada ABONE HAREKET içinde aynı kurallar geçerli İPTAL olan bir hizmete dair SON kez İPTAL içerikli bir hareket satırılı oluşturulur. ve bir daha o hizmet asla hareket görmemeli! bunu senin de dediğin gibi SQL tabloda bayraklamak ile işaretlemek ile mümkün..
ayrıca ABONE HAREKET dosyası hakkında şöyle bir fikir birliğinize varmıştık..
ABONE HAREKET tablosu bir günde bile (şu an aktif abone sayısı 500 Olduğunu ve günde her abone günlük 10 hareket geliştirse desek ABONE HAREKET sadece bir günde 5000 satıra oluşacak..ve bu SQL tablosundan çekilecek BTK sunucuuna gönderilecek olan "ABONE HAREKET" dosyasının hazırlanma süresini geciktirecektir.. ABONE HAREKET dosyalarını her gün saat 01:00’da iletecek, abone hareket dosyaları bir önceki güne ait değişiklikler ile önceki gönderilen abone hareket dosyalarında iletilmeyen değişiklikleri içerecek olmasından anlaşılacağı üzere takriben günde en az 5000 satırlık (Her yeni abone ile bu daha artacak olan) bir tabloyu hem canlı verilerin çekildiği hem de uzun süreli bir arşiv tutmak çok akıllıca olmayacak diye karar verdik hatırlıyor musun?
onun için iki farklı "ABONE HAREKET" tablosu oluşturalım;
ilk ve canlı "ABONE HAREKET" tablosu: kaç günlük veriyi içereceğini (en az 2 günlük olmak kaydı ile)  modülün uygun sayfasında (Büyük ihtimal ile Raporlara ilişkin sayfayı biraz daha geliştirmemiz gerekecek) belireceğimiz süre aralığında ki tüm canlı (anlık) veriler tutulacak (niye en az 2 günlük.. BTK FTP sunucusuna gönderim yapıldıktan sonra aynı gün içinde oluşacak veriler BTK'nın tabiri ile gönderilemeyen hareketlerin 2. güne sarkabileceğini ön gördük.) (Niye sadece 2 güne sabitlemek yerine modül içinde bur süreyi istediğimiz gibi dinamik tutmalıyız:  Çünkü bazen BTK tarafındaki otomasyon dosya formlarını ve/veya içeriklerini kontrol etmekte gecikebiliyor... Böyle bir durumda şayet gönderdiğimiz dosya veya içeriği hatalı ise BTK o dosyaları yeniden gönder bize diyebiliyor.. bu ara bir dipnot daha: BTK' ya bir rapor içeriği ilk defa gidiyor ise ("ABONE REHBER" ve "ABONE HAREKET") için uygulanacak CNT formülünü hatırlıyorsun değil mi? işte bu aşamada bize  tabloda üç ayrı alanın daha gerekiyor;
ilk alan: BTK'ya gönderilen satırların işaretlenmesi senin tabirinle bayraklama işlemi için ihtiyacımız olacak.
ikinci alan : CNT (Count) Alanı : BTK'ya gönderilecek olan verilerin içeriklerin gönderilmesi esnasında belirnen dosya isimlerini oluşturan elementlerden birisi olan CNT sayısının tutulacağı alandır. bu alan veri ilk oluşturulur iken DEFAULT olarak (01) olmalıdır. BTK tarafından Aynı içeriğine sahip Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak. buradaki maksat dosyaların aynı isimler birbirlerinin üzerine kayıt edilmesinin önüne geçmek olabilir veya her iki dosyayı elde tutup doğrulamak için de olabilir.
üçüncü alan: İlgili verinin dahil edildiği BTK dosyanın adını içerecek alandır.
ÖRNEK : IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn
Şayet bu üç tabloyu oluşturmaz isek btk bir veriyi tekrar istediğinde içerik olarak aynı olsa da (dosya oluşturma algoritması arasında yer alan sistem tarihi, ve saati değişeceği için BTK bunu istemiyor. Gönderilen ilk dosya adı ile ama CNT bir artırılmış olarak gönderilmesi istenmektedir.
CNT (Count): Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak iletilir.
Örnek dosya isimi:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn”
SIKIŞTIRILMIŞ OLARAK FTP SUNUCUNA GÖNDERİLENLERE DOSYALARA ÖRNEK:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn.gz”

Dosya yapısı ve içeriğine ait bilgilerin tamamı zaten BTK TEKNİK 314_KK_Abone_Desen.pdf Dokümanında mevcut.. ben sana tekrar hatırlatmak istedim.
ARŞİV "ABONE HAREKET" tablosu: Canlı (anlık) veri tablosunda ki verilerin (canlı tablodaki konaklama (bulundurulma süresi dolan verilerin) Arşivleneceği bir tablodur.
Bu arşivlemenin Kaç günlük veriyi içereceğini modülün uygun sayfasında (Büyük ihtimal ile Raporlara ilişkin sayfayı biraz daha geliştirmemiz gerekecek) belirlemeliyiz. Zaten BTK'ya (ANA FTP SUNUCUSUNA) gönderilen Her dosya aynı anda YEDEK FTP sunucuna gönderiliyor iken tekrar böyle arşivlemeye neden ihtiyaç duyuyoruz. Evet YEDEK FTP SUNUCUMUZDA bu verilerin tamamı saklanacak ancak bu öyle bir hale gelecek ki bu dosyaların kapsamı on yılları aşacak (şu an faaliyetimizin 12. yılındayız) olur da canlı verinin yaşam süresini aşan bir veriyi BTK talep edecek olursa en azından (SQL yapımızın kaldırabileceğin süre boyunca) 5-6 aylık süre ile bile olsa verilerin burada sistemin içinde (ARŞİV "ABONE HAREKET") tablosunda mevcut bir veri ise hemen bir dakika içinde BTK tarafından istenen verinin yeniden gönderilmesi sağlanabilecektir. CANLI tarafta ki tekrar gönderim aşamaları ve gerekli tablolar zaten aynı olacaktır.
ayrıca bir konuda bir ilave daha yapmamız gerekiyor;
Ola ki "ABONE HAREKET" ve/veya "ABONE HAREKET" verileri arasında  SQL tablolarda yaşam süresi doldurduğu için artık tabloda yer almayan bir veri veya veri kümesini BTK aradan yıllar geçse bile.. (Bu bilgilerin saklanma süresi MEVZUATTA 30YILDIR) şu isimli veya şu tarih aralığındaki "ABONE HAREKET", "ABONE HAREKET", "PERSONEL LİSTESİ" BTK'ya gönder talebi geldiğinde bu talebi otomatik olarak sağlayacak şekilde bir FTP YEDEK SUNUCUDAN GÖNDER başlığı altında bir alan olmalı bu alanda;
zaten modülün config ekranında tüm ilgili dosyalara ait FTP dosya yolları belli olduğu için aranacak yerler zaten belli.. YEDEK sunucudan çekilecek VERİNİN TÜRÜ bir drop menü ile çekilebilir ""ABONE HAREKET", "ABONE HAREKET", "PERSONEL LİSTESİ" ) türünden sonra iki search alanı olmanı birisi dosya ismi diğeri de verilen iki tarih arası aramada listenene dosya(lar) ekrana listenir ve yanlarında BTK'ya yeniden gönder sekmesi seçilerek işlem başlatılmışmış olur. burada süreç biraz daha farklı ilerleyecektir. Çağrılan sıkıştırılmış ".gz" dosyası ve onun içinde yer alan ".abn" dosyasının içeriğine hiç bir değişiklik yapılmayacak ancak tekrar gönderilen dosyaların adına ilişkin CNT bir artırılması kuralığı gereği sıkıştırılmış dosyanın içindeki ".abn" dosyası temp klasöründe ".gz" içinden çıkarılarak dosyanın adındaki CNT bir artırılarak yeniden ".gz" formatında sıkıştırılması sağlanmalı (".abn" dosya adı değiştiği için zaten ".gz" ismi de değişmiş olacak.. bu benim aklıma gelen olan bir yöntem başkaca teknikler de üretebiliriz.

Belki de BTK en başından "yeniden gönder" yapısının böyle kurgulanmasını istiyor olabilir... öyle bir durumda oturup yeniden modülü yeniden yazmak zorunda kalmayız... BTK nereden hangi metodla isterse o şekilde göndeririz :)
Şayet vefatı tespit edilebilecek bir seçenek yok ise Periyodik NVI doğrulamalarında, eğer bir TCKN artık doğrulanamıyorsa (ki bu vefat dışı sebeplerle de olabilir), bu son derece doğru bir tespit bu konuda ekranda ve ayrıca loglarda bir uyarı Şu aboneye ait TCKN artık geçersiz diye bir uyarı verilir ise ilgili personelin aboneye çeşitli iletişim araçları üzerinden erişmeye ve yaşayıp yaşamadığına teyit edilmesi ve bu teyit durumunda vefat işlemlerinin manuel başlatılması için bir seçenek ilave edilebilir. https://tckimlik.nvi.gov.tr/Home bu sayfayı derinlemesine bir incelemen gerekiyor
ayrıca en az TCKN no kadar önemli bir doğrulama da "ADRES KODU" doğrulaması bununla ilgili görüşmelerimizi hatırlıyor musun? https://adres.nvi.gov.tr/home Abone Yerleşke ve tesis adreslerinin  UAVT, "Ulusal Adres Veri Tabanı" doğrulanması ve UAVT Numarasının  doğru olarak girilmesi sağlanmalıdır. bir araştırma yapmalısın https://adres.nvi.gov.tr/VatandasIslemleri/AdresSorgu veya benzeri sitelere bizdeki adres bilgilerin enjekte ederek ADRES KODU'nu doğruyabilecek miyiz bir araştırma yapanı istiyorum
BTK mevzuatlarına göre bir abonenin (hizmet(leri) iptal edilse hatta abone vefat etse bile) "ABONE REHBER" yapısında bazı veriler hayatın doğal akışında da olduğu gibi "Bireysel abonelerde TCKN, Adı, Soyadı gibi.. ) "Kurumsal abonelerde Vergi Kodu ve Mersis Kodu gibi) hiç bir suretle değişmesi mümkün olmayan verilerin modül içinde de değişmesine veya silinmesine hiç bir şart altında izin verilmemesi gerekiyor.
Bu konuya ek olarak hatırlıyor musun NVİ üzerinden TCKN doğrulaması yaptırmamız gerekiyordu.. bu konuda bir araştırma yapmalısın bu kişilerin hayatta olup olmadığını.. şayet vetfat etmiş ise tüm hizmetlerinin BTK Teknik dokümanında ki VEFAT eden abonelere uygulanması istenen işlemlerin yapılmasını da sağlamalıyız. bu konuda iyi bir araştırma yapmalısın.
modül temamızın genel prensibi modülü kullanacak olan personeli aynı zamanda özellikle BTK Usul ve mevzuatları noktasında küçük bilgi notları sayesinde eğitmektir. modülün gerekli tüm ilgili alanlarına özellikle veri giriş alanlarının yanına yakınına (i) info simgesi eklemeni kliklemeye gerek kalmadan, ilgili info simgesinin üzerine gidildiğinde ufak ta olsa bir bilgilendirme balonu açılmasını istiyorum. bu talebimi hatırlıyor musun?
bu ufak bilgi notlarını hazırlayabilmek için BTK web sayfalarından yararlanabilirisin.
Bu modül resmi bir Devlet kurumu olan BTK trafından yetkilendirilmiş olduğumuz konularda sunduğumuz hizmetlere İlişkin; "ABONE REHBER", "ABONE HAREKET" ve "PERSONEL BİLGİLERİNE"  verilerin, yine BTK tarafından sağlanan TEKNİK DÖKÜMANDA (314_KK_Abone_Desen.pdf) istenildiği şekilde göndermek üzerine olduğu için aşağıda linklerini verdiğim adreslerden tüm ilgili mevzuatlar öğrenmeni istiyorum.
BTK'nın bu göndereceğim bilgilerde usulsüzce bir değişikliğe karşı hiç bir şekilde taviz vermediğini daha net anlaman için sana bir de ceza kararı göndereceğim
https://www.btk.gov.tr/kanunlar
https://www.btk.gov.tr/bakanlar-kurulu-kararlari
https://www.btk.gov.tr/yonetmelikler
https://www.btk.gov.tr/tebligler
https://www.btk.gov.tr/kurul-kararlari (özellikle ceza ve idari yaptırım kararlarını iyi öğrenmelisin ki bizde aynı hatalara düşmeyeleyim)

Burada bir önemli konu daha var;
Personel Listesi:
PERSONEL LİSTESİ (aslında bu veri daha önce BTK' ya e-posta aracılığı ile gönderiliyordu birazda kişisel veri mahremiyetini gözetmek için FTP sunucuna bırakın denildi) dolayısı ile oraya 6 Ayda bir gönderilecek dosya hep aynı isimde olacak "Personel_Listesi.xlsx"
Ancak bu YEDEK FTP yapısında (arşivleme yapılacağı için) baz değişiklikler yapmak zorundayız.
örneğin:
Personel_Listesi_2024-1.xlsx
Personel_Listesi_2024-2.xlsx
EXCELL dosyasının adı Ait olduğu yıl ve gönderilme dönemi veya gönderildiği ay bilgi de eklenerek farklılaştırılmalı böylece dosyalar birbirlerinin üzerine yazılmazlar. bu arada belki de BTK' da gönderimin böyle olmasını istiyordur.
PERSONEL ekranında dosyayı gönderim ekranında dosya adına "YIL-AY" ilave edilsin diye bir seçenek ekleyelim.
Bu her iki FTP (ANA ve YEDEK) sunucu içinde ayrı ayrı sorulsun. böylece hem biz YEDEK FTP Yedek sunucunda dosyaları üst üste yazılmasının önüne geçerek arşivleme yapmış olacağız hem de günün birinde BTK Teknik Uzmanları da dosyaların üzerine yazmayı farklılaştırın dediklerinde bir daha modül yazma derdine düşmeyiz.
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/Personel_Listesi.xlsx
btkya gönderilecek excell dosyası oluşturulacak. ancak excelde olmayan alanlar şimdiden kendi İK yapımızın oluşması için bize veri sağlayacaktır.
EV ADRESİ (BTK için olmasa da İK için, manuel giriş)
ACİL DURUMDA ARANACAK KİŞİ VE İLETİŞİM BİLGİLERİ (BTK için olmasa da İK için, manuel giriş)
İŞE BAŞLAMA TARİHİ (BTK için olmasa da İK için, manuel giriş)
İŞTEN AYRILMA TARİHİ (BTK için, Excel'de sadece mevcut çalışanlar listelenecek, manuel giriş)
İŞ BIRAKMA NEDENİ (BTK için olmasa da İK için, manuel giriş)
Yukardaki alanlar Bizim Kendi İK yapımız için gerekli olacaktır.
BTK LİSTESİNE EKLENSİN (Checkbox, API kullanıcıları gibi kayıtların hariç tutulması için) bu alan ise hatırlıyorsan veri girişi iki şekilde oluşacak. ilki daha modül kurulur iken whmcs yöneticiler (config admins) bölümündeki mevcut olanları modüllümüzün personel bölümüne otomatik olarak çekecek ancak bunlardan bazı (insan olmaya) banka posları veya robotic müşteri temsilcisi v.b. otomasyon API yapılarını yönetmek için tanımlanmış hesaplardır. onları BTK raporundan uzak tutmak için BTK LİSTESİNE EKLENSİN (Checkbox, API kullanıcıları gibi kayıtların hariç tutulması için) yapısına ihtiyacımız var. eksik kaldığım veya unuttuğum bir şey varsa sen tamamla lütfen.. öneri ve fikirlerini duymak isterim.


Direkt olarak btk veya ona ait raporlarla ilgisi yok ancak Sorun yaşayan Abonelerimizi göndereceğimiz teknik destek saha ekibinin yaşadığı bir soruna çözüm üretebilmek için WHMCS admin panelindeki "clients profile" alanına (TESİS) adres konum bilgilerini (koordinatlarını) girebileceğimiz bir alan eklensin ve bu alandaki "koordinat" bilgileri kullanılarak WHMS admin panelinin "clients summary" alanında google map uydu formatında (sayfanın bütünlüğünü bozmadan) görüntülensin ve google map konum görüntüsünün hemen altında ilgili personelin seçilebileceği (Mevcut personel bölümünde BTK' gidecek bilgileri arasında da yer alan personel tablosundaki "Çalıştığı birim" alanına "initial_reference_data.sql" işlemleri esnasında  https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/personel-departman-gorevleri.xlsx "personel-departman-gorevleri.xlsx" dosyasındaki belirtilen departmanlar eklesin) bu google map bölümüne çağrılacak personel listesi sadece "Bilgi Teknojileri Departmanı'nda" çalışan personellerin arasından (personel tablosuna bölümüne "görev bölgesi" alanı eklenilsin) abone TESİS İLÇESİ ile eşleşen personellerin geleceği bir drop menü ile seçimi sağlansın ve ve personele eposta olarak konum bilgisini içeren bir link gönderilsin. bunun üzerine düşüne ve bunu projeye dahil et.
githup deparman dosya link: https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/personel-departman-gorevleri.xlsx
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/Plesk.Linux-PHP-Sunucu_Bilgisi.pdf
WHMCS sistemine ilişkin konfigürasyon ayarları hakkında bilmen gerek bir konuda config.php satırları arasında yer alan
$customadminpath = 'yonet';  ile WHMCS admin URL adresi belirleniyor.
Projeye ait kod veya resimlerde bu "URL ADRES" bilgisine ihitaç duyabilirsin
Teknik altyapıdan sonra bizi biraz tanımanı isterim. böylece hedeflerimizi daha iyi analiz edebilirsin.
Şirket Olarak Bilgi Teknolojileri ve İletişim kurumu tarafından İSS ve AİH konularında yetkilendirilmiş olarak iletişim faaliyeti yürüten bir işletmeyiz.
Abonelerimize verdiğimiz hizmetleri ve politikalarımızı tanımak ve anlamak için aşağıda linklerini paylaştığım WHMCS tabanlı kurumsal web sayfamızı da incelemeni istiyorum.
https://wwww.kablosuzonline.com.tr/wisp/
https://www.kablosuzonline.com.tr/wisp/kurumsal-bilgilerimiz
https://www.kablosuzonline.com.tr/wisp/knowledgebase
Bu modül resmi bir Devlet kurumu olan BTK trafından yetkilendirilmiş olduğumuz konularda sunduğumuz hizmetlere İlişkin; "ABONE REHBER", "ABONE HAREKET" ve "PERSONEL BİLGİLERİNE"  verilerin, yine BTK tarafından sağlanan TEKNİK DÖKÜMANDA (314_KK_Abone_Desen.pdf) istenildiği şekilde göndermek üzerine olduğu için aşağıda linklerini verdiğim adreslerden tüm ilgili mevzuatlar öğrenmeni istiyorum.
https://www.btk.gov.tr/kanunlar
https://www.btk.gov.tr/bakanlar-kurulu-kararlari
https://www.btk.gov.tr/yonetmelikler
https://www.btk.gov.tr/tebligler
https://www.btk.gov.tr/kurul-kararlari (özellikle ceza ve idari yaptırım kararlarını iyi öğrenmelisin ki bizde aynı hatalara düşmeyeleyim)
Öncelikle benimle konuşurken ve modülü yazarken türkçe ile tam uyumlu olmanı istiyorum.
Bu projenin hiç bir aşamasında bana manuel iş yükleme zaman kaybettirme.. her türlü düzeltme derleme işlemlerini senin yapmanı ve bana dosyanın en son düzenlenmiş halinin bütününü eksiksiz olarak vermeni istiyorum.
sana modüle dait bir teknik dokuman (314_KK_Abone_Desen.pdf) gönderiyorum.
btk kurumunun istediğini verileri whmcs üzerinden çekip istenilen dosyaları istenilen zamanda ve istenilen şekilde gönderilmesini sağlayacak bir modül yazmanı istiyorum.
Bu modülün nasıl görünmesine dair (ANASAYFA ve CONFIG Sayfalarına dair) görsel TEMA tasarımlarını ekte gönderdim. temalara ilişkin tpl kodlamalarında bu örnek iki TEMA TASARIMINI kullanarak diğer ekranları da bu şekilde dizayn etmeni istiyorum.
whmcs modül kurulumu esnasında (modülün yönetim bölümünde güncellenebilmesi de sağlanacak şekilde) btk tarafından hangi konularda yetkilendirilmiş olduğunu seçimi sağlanmalı birden çok kutucuk işaretlenmesine olanak sağlanmalı ve seçilen her faaliyet alanına dair istenen verilere ilişkin ayrı ayrı dosyaların oluşması sağlanılmalı.
BTK YETKİ TÜRLERİ DE ŞU ŞEKİLDEDİR.
Yetkilendirme Türü
Altyapı İşletmeciliği Hizmeti (B)
Altyapı İşletmeciliği Hizmeti (K)
GMPCS Mobil Telefon Hizmeti (B)
GMPCS Mobil Telefon Hizmeti (K)
GSM (İmtiyaz Sözleşmesi)
Hava Taşıtlarında GSM 1800 Mobil Telefon Hizmeti (B)
IMT (Sayısı Sınırlandırılmış Kullanım Hakkı Yetki Belgesi)
IMT-2000/UMTS (İmtiyaz Sözleşmesi)
Kablolu Yayın Hizmeti (B)
Ortak Kullanimli Telsiz Hizmeti (K)
Rehberlik Hizmeti (K)
Sabit Telefon Hizmeti (B)
Sabit Telefon Hizmeti (K)
Sanal Mobil Şebeke Hizmeti (B)
Sanal Mobil Şebeke Hizmeti (K)
Uydu Haberleşme Hizmeti (B)
Uydu Platform Hizmeti (B)
Uydu ve Kablo TV Hizmetleri
Çeşitli Telekomünikasyon Hizmetleri (İmtiyaz Sözleşmesi)
İnternet Servis Sağlayıcılığı (B)
Yetki Türlerindeki (B) Yetkinin Bildirim Kapsamında Olduğunu, (K) ise Yetkinin Kullanım Kapsamında Olduğunu ifade etmektedir.
Ayrıca whmcs modül kurulumu esnasında (modülün yönetim bölümünde güncellenebilmesi de sağlanacak şekilde) btk tarafından bildirilen "OPERATÖR KODU" ve "OPERATÖR ADI" ve dosyaların gönderileceği ftp sunucusuna ait bilgilerin ve hangi dosyanın hangi ftp klasörüne yükleneceğine ilişkin tanımların yapılmasını istiyorum.
Config Ekranı sayesinde İlgili Dosyaların gönderilmesi için belirlenene FTP Sunucuyu Belirli Aralıklarla (5 Dakikada bir gibi) Yoklayıp Erişilebilir olup olmadığını kontrol edelim ve Sunucuya Erişim Var İse (Yeşil Renk ile) AKTİF, Şayet Sunucuya Erişim Sağlanamadı ise (Kırmızı Renk ile) PASİF şeklinde modül ana sayfasında info görünsün istiyorum.
Bunlara ilave olarak Modüle İlişkin sürüm güncellemelerine ilişkin zaten hazırladığımız (README.MD gibi) Bir TXT Döküman Hazırlansın ve O dokümana Erişim için Ana Sayfada Link Sağlansın.
Böyle Bir Modülüne ihtiyaç Duymamızın en büyük nedeni BTK tarafından sağlanan TEKNİK Dökümandaki verilerin, WHMCS tarafından karşılanamıyor olması bir çok alan WHMCS'de bulunmuyor bulunanlarda yetersiz kalıyor.
Bu eksiklikleri Customfields üzerinden karşılama düşüncesini daha önceki incelemelerimizde özellikle ürün/hizmet bilgileri kısmında her bir hizmet için ayrı ayrı product fields oluşturmak gerektiği Customfields yapısının Value ve field yapısının iki ayrı tablo ile yönetildiği görüldü bu hem büyük bir veritabanı karmaşasası hemde verinin doğruluk ve bütünlüğünü sağlamanın zorlaşacağına karar verdik. Ayrıca Abone veya Hizmetlere ilişkin Hareketlerin kancalar yardımı ile Customfieldsleri tetikleyemecek olduğunu fark edince
modülün ihtiyaç duyduğu veriler için modulun kendine ait sql tablolarının olmasına karar verdik.
whmcs modül kurulumu esnasında whmcs'de olmayan bu veri alanların teknik dokumanın istediği verileri karşılayacak şekilde oluşturmasını sağlayalım.
yapıtığımız çalışmada ilgili alanların whmcs ile eşleşenlerini de şu şekildedir;
BTK'DAN İSTENEN:	OPERATOR_KOD	MUSTERI_ID	HAT_NO	HAT_DURUM	HAT_DURUM_KODU	HAT_ACIKLAMA	MUSTERI_HAREKET_KODU	MUSTERI_HAREKET_ACIKLAMA	MUSTERI_HAREKET_ZAMANI	HIZMET_TIPI	MUSTERI_TIPI	ABONE_BASLANGIC	ABONE_BITIS	ABONE_ADI	ABONE_SOYADI	ABONE_TC_KIMLIK_NO	ABONE_PASAPORT_NO	ABONE_UNVAN	ABONE_VERGI_NUMARASI	ABONE_MERSIS_NUMARASI	ABONE_CINSIYET	ABONE_UYRUK	ABONE_BABA_ADI	ABONE_ANA_ADI	ABONE_ANNE_KIZLIK_SOYADI	ABONE_DOGUM_YERI	ABONE_DOGUM_TARIHI	ABONE_MESLEK	ABONE_TARIFE	ABONE_KIMLIK_CILT_NO	ABONE_KIMLIK_KUTUK_NO	ABONE_KIMLIK_SAYFA_NO	ABONE_KIMLIK_IL	ABONE_KIMLIK_ILCE	ABONE_KIMLIK_MAHALLE_KOY	ABONE_KIMLIK_TIPI	ABONE_KIMLIK_SERİ_NO	ABONE_KIMLIK_VERILDIGI_YER	ABONE_KIMLIK_VERILDIGI_TARIH	ABONE_KIMLIK_AIDIYETI	ABONE_ADRES_TESIS_IL	ABONE_ADRES_TESIS_ILCE	ABONE_ADRES_TESIS_MAHALLE	ABONE_ADRES_TESIS_CADDE	ABONE_ADRES_TESIS_DIS_KAPI_NO	ABONE_ADRES_TESIS_IC_KAPI_NO	ABONE_ADRES_TESIS_POSTA_KODU	ABONE_ADRES_TESIS_ADRES_KODU	ABONE_ADRES_IRTIBAT_TEL_NO_1	ABONE_ADRES_IRTIBAT_TEL_NO_2	ABONE_ADRES_E_MAIL	ABONE_ADRES_YERLESIM_IL	ABONE_ADRES_YERLESIM_ILCE	ABONE_ADRES_YERLESIM_MAHALLE	ABONE_ADRES_YERLESIM_CADDE	ABONE_ADRES_YERLESIM_DIS_KAPI_NO	ABONE_ADRES_YERLESIM_IC_KAPI_NO	ABONE_ADRES_YERLESİM_NO:	KURUM_YETKILI_ADI	KURUM_YETKILI_SOYADI	KURUM_YETKILI_TCKIMLIK_NO	KURUM_YETKILI_TELEFON	KURUM_ADRES	AKTIVASYON_BAYI_ADI	AKTIVASYON_BAYI_ADRESI	AKTIVASYON_KULLANICI	GUNCELLEYEN_BAYI_ADI	GUNCELLEYEN_BAYI_ADRESI	GUNCELLEYEN_KULLANICI	STATIK_IP	ISS_HIZ_PROFILI	ISS_KULLANICI_ADI	ISS_POP_BILGISI
WHMCS DE VAR OLAN:		tblclients.id	tblhosting.id						WHMCS'DE MÜŞTERİ VE/VEYA ÜRÜNLERE İLİŞKİN HER TÜRLÜ GÜNCELLEMENİN ZAMANI			tblhosting.regdate		tblclients.firstname	tblclients.lastname			tblclients.companyname	tblclients.tax_id																														tblclients.phonenumber		tblclients.email	tblclients.city	tblclients.state																	tblhosting.dedicatedip		tblhosting.username	tblhosting.server 
Teknik dökümanda istenen verilerin oluşturulması esnasında; whmcs modülüne ait veritabanı alanlarından "TC.KİMLİK NO" ve "YABANCI KİMLİK NO" alanlara verişi girişi esnasında verilerin Türkiye Cumhuriyeti Devleti, Nüfus ve Vatandaşlık İşleri Genel Müdürlüğü
https://tckimlik.nvi.gov.tr üzerinden doğrulamasını sağlayacak bir api ilave etmeni istiyorum. veri girişi yapıldıktan sonra ikinci bir veri alanına geçerken veya enson verileri kayıt etme aşamasında bu doğrulama yapılabilir hangisi doğru ise onu tercih edebilirsin.
yapılacak bu doğrulama aşamasında api'nin ihtiyaç duyucağı verilerin, TEKNİK DÖKÜMANDA İSTENEN VERİLER ARASINDA OLMASI işimizi kolaylaştıracaktır. 
bu konuda araştırma yap ve en doğru yöntemle doğrulamayı gerçekleştir. hatalı bir sonuç döner ise yanış olan "TC.KİMLİK NO" ve/veya "YABANCI KİMLİK NO" bilgilerini ekranda göster ve bu yanlış verilerin whmcs modülüne ait tablolarına yazılmasına izin verme. Ayrıca Bu doğrulama işlemi teknik veri dosya(larını) oluşturma aşamasında gerçekleşmesini sağlamalısın. Hatalı olan doğrulanmamış olan "TC.KİMLİK NO" ve/veya "YABANCI KİMLİK NO" düzeltilmesi gerektiğinine dair uyarı mesajını ekranda göster ve modülün log klosöründe hataları "TC.KİMLİK NO" ve/veya "YABANCI KİMLİK NO" bilgilerini dair log dosyası oluştur.
Türkiye Cumhuriyeti Vatandaşları için : https://tckimlik.nvi.gov.tr/service/kpspublic.asmx?op=TCKimlikNoDogrula
YABANCILAR için: https://tckimlik.nvi.gov.tr/service/kpspublicyabancidogrula.asmx?op=YabanciKimlikNoDogrula
ÖRNEK BTK Abone verisi:
701|;|1000001|;|1343|;|A|;|1|;|AKTIF|;|1|;|HAT DURUM DEGISIKLIGI|;|20240517030741|;|WIFI|;|G-SIRKET|;|20160824080000|;|00000000000000|;|TAMER|;|GENÇEL|;||;||;||;|32479043158|;||;|E|;||;||;||;||;||;|0000-00-00|;||;|ONODEMELI|;|0|;|0|;|0|;||;||;||;||;||;||;|0000-00-00|;|B|;|BALIKESİR|;|AYVALIK|;|KÜÇÜKKÖY MAHALLESİ ATATÜRK BUL. AZEMBEY SOK.|;|AZİM APT. NO:6 D:2 (1031832817)|;||;||;|10410|;|0|;|+90.542 615 61 88|;||;|tamer.gencel@kablosuzonline.com.tr|;|BALIKESİR|;|AYVALIK|;|KÜÇÜKKÖY MAHALLESİ ATATÜRK BUL. AZEMBEY SOK.|;|AZİM APT. NO:6 D:2 (1031832817)|;||;||;|0|;|TAMER|;|GENÇEL|;|0|;|+90.542 615 61 88|;|KÜÇÜKKÖY MAHALLESİ ATATÜRK BUL. AZEMBEY SOK. AZİM APT. NO:6 D:2 (1031832817) AYVALIK BALIKESİR|;||;||;||;||;||;||;|192.168.1.258|;||;|32479043158|;|2\n
bir önemli husus daha var, Tüm Adres Bilgilerinin (İL, İLÇE, MAHALLE, SOKAK/CADDE/BULVAR, BİNA ADI, DIŞ KAPI NO, İÇ KAPI NO, ADRES KODU, POSTA KODU gibi ) tüm adres bilgilerinin ister YERLEŞİM, ister TESİS, ister ise KURUM YETKİLİSİNE ait olsun tüm adreslerin doğruluğunu ve bütünlüğünü sağlamak için BTK tarafından nvi adres doğrulama istenmektedir. Ancak NVİ ile yapılan tüm görüşmelerde KPS sistemine dair taleplerimiz kabul edilmedi.
Doğrulama yapamadığımız için Modül içindeki Tüm Adres Bilgilerinin (İL, İLÇE, MAHALLE, SOKAK/CADDE/BULVAR, BİNA ADI, DIŞ KAPI NO, İÇ KAPI NO, POSTA KODU gibi ) Bilgilerin Sisteme girişinde oluşacak insan ve kalavye hatalarının önünde geçebilmek ve veri girişini hızlanladırabilmek için Seçmeli Drop Menüler ile (İL Seçilince, O İL'in İLÇELERİ, İLÇELER arasından yapılacak seçimle o ilçeye ait Mahalleler, Mahalle Seçilince, O Mahalleye ait Cadde/Sokak/Bulvar, Cadde/Sokak/Bulvar seçildiğinde BİNA ADI veya BİNA NO, Bina adı veya Bina  No Seçildiğinde ise DAİRE NO) bilgilerinin bir drop menü araclığı ile ekrana getirilmesi sağlamalısın. böylece personel ve klavye giriş hataları  ortadan kaldırılır. daha önce bu verilerin java üzerinde mi yoksa veritabanında mı tutmak konusunda yaptığımız tartışmada veritabanında tutulmasının daha doğru olacağına karar verdik.
Adreslere ilişkin bir diğer önemli hususta evet whmcs müşteri bölümünde adres girilebiliyor ancak bu adresler hem btk'nın istediği gibi İL, İLÇE, MAHALLE, SOKAK/CADDE/BULVAR , BİNA ADI, DIŞ KAPI NO, İÇ KAPI NO, POSTA KODU , ADRES KODU gibi adres bilgilerini ve btk'nın talep ettiği aboneye ait kimlik bilgilerini gibi bir çok spesifik veriyi içermiyor. ayrıca en büyük eksikliklerden birisi de evet yetersizde olsa aboneye ilişkin bir adres var ve hatta birden çok kontak bilgisi de ilave edilebiliyor ancak, bazen bir müşteri birden çok adreste hizmet alabiliyor örneğin aynı abone  evinde, iş yerinde, merkezinde, şubesinde, fabrikasında, ofisinde bir den çok hizmete farklı farklı adreslerde ürün ve hizmetleri olabiliyor btk bunların hepsinin her bir ürün için TESİS ADRESİ olarak detaylandırılması isteniyor özetle btk abone değil aktif pasif tüm ürünlerin raporlanmasını istemektedir.
BTK Teknik Dosyasında Raporlanması istenen Abone YERLEŞİM(İkamet) Adresi Whmcs yönetim panelindeki "clients profile" bölümden girişi sağlanmalı.
Aboneye Hizmet ve Ürün Satışı Esnasında veya Sonrasında (clients services" bölümünde olabilir) YERLEŞİM ve HİZMET TESİS Adresi Aynı olup olmadığı sorulsun (seçim kutucuğu konulabilir).
Şayet Yerleşim ve Hizmet Tesis adresi aynı ise Yerleşim adresindeki verilerin otomatik olarak TESİS ADRESİ "clients services" bölümüne de işlenmesi sağlansın. BTK aynı bile olsa bu iki adresinde girilmesini istiyor.
Ayrıca Aboneye ait bile olsa Her bir ürün/hizmet için ayrı ayrı "tesis adresi" whmcsdeki "clients services" bölümünden girilmesi sağlanmalı.
Modülün ana konusu olan BTK Rapor(ları) için gerekli olmasa da ek olarak abonenin internet erişim hizmetine ilşkin bakım ve onarım için giden teknik ekibin tesis adresini google map üzerinden konum bilgisi alanı da eklensin. Böylece Teknik ekip direk konuma gideceği için daha hızlı ulaşım sağlayacaktır.
WHMCS'nin mevcut yapısının bazı sınırlamaları olduğunu ve iş gereksinimlerinizi tam olarak karşılamamıyor.
Özetle, sorun şu:
WHMCS, müşterilerin fatura adreslerini yönetmek için iyi bir sistem sunuyor.
Ancak, hizmetlerin sunulduğu adresler (tesis adresleri) her zaman fatura adresleriyle aynı olmayabiliyor.
Bir müşterinin birden fazla hizmeti farklı adreslerde olabilir (ev, iş yeri, şube vb.).
WHMCS'nin mevcut yapısı, tesis adreslerini hizmetlerle ilişkilendirme konusunda yetersiz kalıyor.
Çözüm Önerisi: clientsservices'e Adres Alanları Eklemek
Bu sorunu çözmek için, "clients services" ekranına adres alanları eklemek mantıklı bir çözüm gibi görünüyor. Bu, her bir hizmet kaydına özel bir adres atamanızı sağlayacaktır.
yine aynı teknik dokümanda dosyaların ftp sunucuna yüklenilmesinden bahsediliyor. her bir işletmecinin kendi ftp sunucusu olduğu için burada teknik dokumanda genel bir ifade kullanılmıştır. bu ftp sunuculara ilişkin bilgiler ve oluşturulacak olan her bir dosyanın yükleneceği klasörler farklıdır. ve süreç içinde bu klasörlerin değiştirildiğini göz önüne alınır ise bu ftp sunucusuna ait erişim bilgileri ve yüklenecek dosyaların hedef yollarını da kod içine gömmek yerine modül ilk kurulurken bu bilgilerin girilmesini ve ilerde oluşacak bir değişik söz konusu olduğunda bu bilgilerin yönetim ara yüzünden güncellenmesini sağlamak daha doğru olacaktır.
modülün tüm kurulum ve yönetim aşamasının güncellenebilen esnek bir yapıya sahip olsun istiyorum.
hooks demişken BTK'nın üzerinde durduğu hassasiyet gösterdiği konulardan birisi da istediğini verilerden birisi bile değişse veya hareket görse HAREKET dosyasına anında yansımasını istiyor bu yüzden kancalar çok önemli :) ayrıca BTK TEKNİK DOKUMANINI detaylı incelersen REHBER dosyaları  Aktif/Pasif/İptal durumu ne olursa olsun tüm Geçmiş veya Mevcut Abone Bilgilerini her ay belirtilen gün ve saatte gönderilmesi gerekiyor.
Diğer HAREKET Dosyası ise Her gün Belirtilen Saatte Bir Önceki gündeki gönderim zamanından bu yana biriken hareketlerin gönderilmesini istiyor.
yani FTP sunucuna bırakılan bir HAREKET diğer günün hareket dosyasında olmaması gerekiyor bu da demek oluyor ki;
REHBER Dosyasında oluşan hiç bir kayıt silinemez ancak güncellenebilir (gerekiyorsa silme korumalı yapılabilir Aboneye Ait Bazı Bilgiler ASLA Değiştirilemez TC. Kimlik No, Ad, Soyad gibi)
Ancak Gönderilmiş olan HAREKET dosyası içinde yer alan veri (şayet veri tabanında tutuluyor ise) HAREKET.ABN.GZ dosyasına yazıldığı an veritabanından silinmeli ki mükerret hareket kaydı oluşmasın.
BTK YETKİLENDİRME TÜRLERİNİ çok iyi anlamanı istiyorum. hassas bir konu Bir işletmeci Birden çok YETKİLENDİRME TÜRÜNE Sahip olabilir.  Ürünlerin/hizmetlerin hangi YETKİ TÜRÜNE haiz olduğunu her ürün veya ürün gurubu için belirlenmeli ve o yetki türüne ait gönderim şekline ve dosya formatına gönderilmeli. Diyelim ki bir işletmeci Hem ISS hemde AİH yetki türüne sahip ama sadece İSS abonesi ve hizmeti sunmuş. BTK zaman zaman karar değişikliğine gidip boşta olsa eğer o türe ait yetkilendirilmiş isen boş bile olsa o dosyayı FTP yükleyeceksin diyebilmektedir. yönetim ekranında abone/hizmet olmasada boş veri gönder diye bir kutucuk konulmasında fayda var ne dersin?
bu konu biraz karışık sana şöyle özetliyeyim bir İnternet Servis Sağlama işini, Nihai son kullanıcıya sunar isen bu İSS yetkisi kapsamında değerlendiriliyor, ancak aynı ürünü yine sizin gibi BTK tarafından yetkilendirilmiş bir başkaca işletmeciye bu hizmeti sunuyor iseniz ve o hizmet üzerinden o işletmeci kendi abonelerine hizmet veriyor ise yani sizden alıp başkasına satıyor ise o zaman BTK sizin o hizmet AİH (altyapı İşletmeciliği Hizmeti) kapsamında değerlendiriyor. yani ürünün veya hizmetin ne olduğu kadar.. abonenin de kim olduğu etken... bu konuyu da öğrendiğine göre önerilerini tekrar dinlemek isterim.
ayrıca sana modülün şu ana kadar ki gelinen noktasını gösteren modul-durum-raporu.pdf raporunu göndereceğim ve yazdığımız kodların son hallerini de oradan devam edelim.
senden WHMCS 8.13.0-release.1 versionunu ve PHP Version 8.1.32 desteği olan (konumuzun dışında bile olsa) tüm whmcs kancalarını öğrenmeni istiyorum.
Ayrıca birazdan bir whmcs-whatsapp Modülüne ait dosyaları da göndereceğim. lütfen onları da incele bizim projeye yakın bir modül. bu modül hook yardımı ile hertürlü müşteri ve ürün değişikliğini aynı anda whatsapp mesajlarını anlık olarak gönderiyor.
BTK tarafından alınan ilgili bir karar ile Her yılın 6. Ve 12. Aylarının sonuna kadar (EK'teki excel örneğindeki bilgileri içerecek şekilde) Mevcut Personel bilgilerin iletilmemesi durumunda ilgili mevzuat hükümleri uyarınca BTK Kurumu tarafından idari yaptırım uygulama yoluna gitme hakkına haiz bulunduğu bilgisine ulaştık.
Bu kez dosya ekteki örnek excel dosya şeklinde yine aynı ftp adresine ancak farklı bir klasöre bırakılması gerekiyor. config ekranından zaten ftp sunucu bilgileri giriş ekranı mevcut idi.. "ABONE HAREKET" Ftp dosya yolunun olduğu giriş alanının hemen altına (CONGIG TEMA TASARIM RESMİNDE OLDUĞU GİBİ) persenel listesini içeren EXCEL dosyasının hangi ftp klasörüne gönderileceğine dair bir giriş alanı olsun.
Personel listesini ve bilgilerin bir bölümü whmc yöneticiler (configadmins) bölümündeki (excelldeki taleplerle eşleşenleri) verileri oradan çekeceğiz. Ancak bu whmcs bölümü istenen tüm bilgileri kapsamıyor.
O nedenle mod_btk_personel adlı oluşturulacak sql tablosuna ihtiyaç duyacağız.
Bu SQL TABLO (mod_btk_personel) Modül İnstall Aşamasında iken oluşturulması sağlanacak.
modül kuruluş aşamasında iken ilk anda zaten whmcs yöneticiler "configadmins" bölümünden ("tbladmins" SQL TABLOSUNDA TUTULUYOR) var olan ve eşleşen alanların "mod_btk_personel" sql tablosuna yazılması sağlansın.
Ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak bu tabloya da yazılması sağlansın.
BU SQL TABLOSUNDA AŞAĞIDAKİ ALANLARDAN OLUŞACAK;
personel_id (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personel için modül tarafından "anahtarlama" (benzersiz) olacak şekilde otomatik oluşturulsun. ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın. whmcs üzerinden çekilecek veriler için kullanacağımız "tbladmins" Sql tablosunun "id" alanı ile "FOREIGN KEY" olarak tanımlanması sağlansın.)
Firma Adı (Modülün config Bölümündeki, "OPERATOR KODU" ve "OPERATOR ADI" bölümlerinin olduğu sql tablosuna ve config.tpl sayfasına "OPERATOR UNVANI" alanı da eklensin ve mod_btk_personel SQL tablosundaki her personel için oradan yazılsın. ancak bu alan hiç bir şekilde "ABONE REHBER" ve/veya "ABONE HAREKET" dosya içeriklerinde yer almayacak. Sadece PERSENOL ALANI için kullanılacaktır.)
bu konudaki şu detayı bilmelisin "OPERATOR ADI" ile "OPERATOR ÜNVANI" aynı şey değil.. "OPERATOR ADI", BTK tarafından belirleniyor genelde şirket unvanlarının kısa isimlerinden oluşuyor türkçe karekter kıllanılmıyor ve buyuk harf ile yazılıyor ve karakterler arasında boşluk olmuyor bunların nedenini sende tahmin etmiş olmalısın.. OPERATOR ADI oluşturulacak olan dosyaların adını ilave geliyor.. örneğin bizim OPERATOR ADI : IZMARBILISIM
"OPERATÖR UNVANI" Şirketin Ticaret sicilinde tescilli resmi adıdır. Tescilde Nasıl yazılıyor ise hiç bir değişiklik yapılmadan aynen yazılır. Bizim Resmi Şirket Unvanımız: İZMAR BİLİŞİM HİZMETLERİ SANAYİ TİCARET LİMİTED ŞİRKETİ
"OPERATÖR UNVANI" Bu datayı sadece PERSONEL Listesi içeren EXCEL dosyasında kullanacağız.
Adı (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personele ait "tbladmins" Sql tablosunun "firstname" alanından alınsın, ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın.)
Soyadı (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personele ait "tbladmins" Sql tablosunun "lastname" alanından alınsın, ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın.)
TC Kimlik No (Müşteri/Abone tarafında zaten doğrula olayını yapmıştık oradaki çalışma üzerinden bu "TC Kimlik No" alanındaki verilerde yine aynı metodla doğrulansın)
Ünvan (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
Çalıştığı birim (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
Mobil telefonu (alan koduyla birlikte 10 hane olarak giriniz), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
Sabit telefonu (alan koduyla birlikte 10 hane olarak giriniz), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
E-posta adresi (Modül henüz Kurulurken, whmcs yöneticiler "configadmins" bölümündeki mevcut tüm personele ait "tbladmins" Sql tablosunun "email" alanından alınsın, ayrıca ilerdeki süreçte whmcs yöneticiler "configadmins" bölümüne eklenen her yeni personel (hooks) kancalar yardımı ile anlık olarak yeni personel bilgisi otomatik olarak oluşması sağlansın.)
EV ADRESİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. İleride bu modül "GÜNÜN BİRİNDE BTK BU BİLGİLERİN GÖNDERİMİNDEN VAZGEÇZE BİLE" Yazdığımız bunca kod boşa gitsin istemem, "PERSONEL İK" olarak geliştirebiliriz. İleri dönük olsun), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
ACİL DURUMDA ARANACAK KİŞİ VE İLETİŞİM BİLGİLERİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. İleride bu modül "GÜNÜN BİRİNDE BTK BU BİLGİLERİN GÖNDERİMİNDEN VAZGEÇZE BİLE" Yazdığımız bunca kod boşa gitsin istemem, "PERSONEL İK" olarak geliştirebiliriz. İleri dönük olsun), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
İŞE BAŞLAMA TARİHİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum.), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
İŞTEN AYRILMA TARİHİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. Zira BTK Excel Dosya Gönderme anında ki İŞ İLİŞİĞİ KESİLENLER HARİÇ, mevcut çalışanların listesini istiyor), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
İŞ BIRAKMA NEDENİ (Her ne kadar BTK EXEL tablosuna işlenecek veriler arasında yer almasa da modüle ilave edilmesini istiyorum. İleride bu modül "GÜNÜN BİRİNDE BTK BU BİLGİLERİN GÖNDERİMİNDEN VAZGEÇZE BİLE" Yazdığımız bunca kod boşa gitsin istemem, "PERSONEL İK" olarak geliştirebiliriz. İleri dönük olsun), (Modül kurulur iken veya sonrasın whmcs yöneticiler "configadmins" bölümündeki bu bölüm olmadığı için bu bölüm boş olacaktır. Ancak personel.tpl ekranından ilgili alanın MANUEL olarak (boş ise) Girişine zorlansın. personel.tpl Ekranından Girilen verilerin kayıtetmesi için oluşturulan sektmeye butona basıldığında halen herhangi bir personelin Girilmeyen eksik bilgileri mevcut ise uyarı verilsin ve kayıt işlemini yapmasın.)
modülün personel yönetim ekranı olan personel.tp ekranında listenen tüm personelin son kısmında bir anahtarlama (seçim) olsun. (BTK LİSTESİNE EKLENSİN) Şeklinde çünkü personel bilgisini whmcs yöneticiler "configadmins" bölümünden çağıracağımız için orada aslında var olmayan ancak bazı entegrasyonlar için (Banka, Sanal Pos v.b. API Erişimleri için) oluşturulmuş hesaplar olabiliyor onların BTK Raporuna eklenmesi doğru olmaz.
Oluşturalacak excel dosyasının adı : Dosyanın adı diğer "ABONE REHBER" ve "ABONE HAREKET" Dosyalarından biraz farklı olacak dosyanın adında ("OPERATOR ADI"Personel_Listesi"DOSYA HAZIRLAN YILI"_"DOSYA HAZIRLAN AYI") Örneğin: IZMARBILISIM_Personel_Listesi_2024_6.xlsx Şeklinde Config.tpl'de belirtilen FTP SUNUCUNUN, personel.tpl'de Dosya Yolu belirtilen FTP Klasörüne excel (formatında) kayıt edilecek.
Oluşturulma zamanları : Her yılın 6. Ve 12. Aylarının son günü saat 16:00
oluşturulan dosyanın içeriği: Dosyanın gönderim zamanında mevcut çalışan personelin listesi
Sana gönderdiğim modul-dosya-tree-yapısı.pdf dosyasını incelersen zaten sende fark edeceksin projenin iskelet yapısını zaten daha önceki seninle olan çalışmalarımızda bir yere kadar getirdik.. kaldığımız yerden devam edelim istiyorum.
Projenin ilerleyen aşamalarında Hatalı veya eksik bölümleri beraber geliştirelim. Örneğin Henüz whmcs Müşteri Panelinde giren Müşterilerin(Abonelerin), Kendisine Ait Bilgilerin "clientarea.php?action=details" ekranında görebileceği ama Hiç bir şekilde Değiştirme, Düzeltme veya Silme Yapamayacağı sayfaların kodlanması gerekiyor.
Ayrıca projenin her aşamasında senin öngörü ve tavsiyelerine açığım. Her türlü katkın beni mutlu edecektir.
Ne Dersin devam edelim mi?
Konuyu en ince ayrıntısına kadar öğrenebilmen için "WHMCS_BTK_Modül_Geliştirme_Projesi_.docx" gibi bir çok dokumantasyon sağladım lütfen detaylı incele ve tüm enerjini bu projeyi tamamlamaya harca.
NOTLAR:
Dikkat edilmesi gereken bazı hususları aktarmak istiyorum. Whmcs Yazılım ekibi çok sık Altı ayda bir gibi sürekli yeni version üretiyorlar.
Çok sık olarak Whmcs kod ve sql tablo yapısının değiştiğini göz önüne alarak mümkün olduğunca whmcs'nin kendi yapısal bütünlüğünü etkilemekten kaçınmalısın. değilse ise WHMCS'nin çıkaracağı ilk yeni versionda modülümüz uyum sorunu yaşayabilir.
Sana bazı talimatlarımı gönderdiğim resim dosyalarının içeriklerinden göreceksin:
MOdülün ANASAYFA Temasının Nasıl Olacağını "TemaAnaSayfa.png"
CONFIG SAYFASI Temasının Nasıl Olacağını "Tema-ConfigSayfa.png"
Modülün TEMA Genelinde neler yer alması gerektiğini, sekme ve seçim butonlarının nasıl olmasını istediğimi "WHMS-BTK-MODUL-SECENEK-BUTON-VE-DIGER-ISTEKLER.PNG"
Projenin her aşamasında proaktif rol almak istiyorum. Her saat başında projeye ait dosya içeriklerini benimle paylaşmanı istiyorum. KOntrolün bende olmasını istiyorum.
Lütfen Arka Planda Yaptığın veya Yapmayı Hedeflediğin en ufak ayrıntıyı bile kaçırmadan bana belirli aralıklar ile bana rapor vermeni istiyorum.
Senden belirli aralıklarla son durum raporu isterim... arka planda yaptığın çalışmalardan beni haberdar etmelisin. Sürecin her adımında beni bilgilendir.
Ayrıca Türkiye'yaşıyorum Kendini (Türkiye/İstanbul) Zamanına göre ayarla.
Ayrıca Proje Aşamasında Talimat ve ayrıntıları unutmaman için ilk talimatları ve proje detay bilgilerini "Gemini_Pro_Talimatlar.txt" Gemini Pro Klasörüne yükledim. unutursan hatırlarsın..
Özellikle dikkat etmen gereken hususları ifade etmek istiyorum;
BTK rehber dosyada durumu ne olursa olsun (aktif/pasif/ iptal/ dondurulmuş diye ayırmadan) tüm hizmetlerin raporlanmasını istiyor.
Bir abonenin (aynı adreste veya farklı bir adreste) birden fazla hizmeti olabilir. böyle bir durumda her bir hizmet içinn ayrı ayrı kayıt satırı açılacak.
BTK'ya gönderilecek olan "ABONE REHBER" ve "ABONE HAREKET" dosyalarındaki bilgilerin eksiksiz oluşturalabilmesi için (ABONEYE VE HİZMETE DAİR TÜM VERİLERİN GİRİLMESİNİN SONRASINDA... ) hizmete ilişkin "siparişi onayla" tuşuna basıldığı an sipariş onay kancasının tetiklemesi ile birlikte "ABONE REHBER, YENİ ABONE" ve "ABONE HAREKET, YENİ ABONE" olacak şekilde ilk kayıt(lar) oluşsun.
Böylece BTK'ya EKSİK BİLGİ gitmemiş olacaktır.
Raporların dosya isim yapısını çok iyi  anlamanı istiyorum.
ayrıca dosya isimleri ne örnekler şu şekildedir;
Her iki raporda da şayet dosyalar ilk defa gönderiliyor ise (CNT) 01 olacak ve Aynı içeriklere sahip rapor mükerrer olarak tekrar gönderilmesi istenirse bu çoğu zaman BTK tarafına eksik paket gitme durumunda isteniyor) eski dosyanın üzerine yazılmasının önüne geçmek için CNT her seferinde bir sayı artırılıyor.
IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_01.abn ( Sıkıştırılmış hali: IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_01.abn.gz )
IZMARBILISIM_701_ISS_ABONE_HAREKET_20240520223100_01.abn ( Sıkıştırılmış hali: IZMARBILISIM_701_ISS_ABONE_HAREKET_20240520223100_01.abn.gz )
IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_02.abn (BTK tarafından herhangi bir nedenle Dosyanın tekrar gönderilmesi talep edildiğinde CNT (Count): iki haneli kod birer arttırılarak iletilir. böylece eski dosyanın üzerine yazılmasının önüne geçilmiş olur)
IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_01.abn.gz (sıkıştırılmış hali)
IZMARBILISIM_701_ISS_ABONE_REHBER_20240520223100_02.abn.gz (sıkıştırılmış hali) (BTK tarafından herhangi bir nedenle Dosyanın tekrar gönderilmesi talep edildiğinde CNT (Count): iki haneli kod birer arttırılarak iletilir. böylece eski dosyanın üzerine yazılmasının önüne geçilmiş olur)
Bir başka önemli hususta geçmiş çalışmalarımızda "ABONE REHBER" ve "ABONE HAREKET" dosyalarının içerikleri ve dosya formatına ilişkin zaman zaman yanlış kararlar almış olmandır.. bunun nedeni bu konuda seni tam aydınlatamamış olmam olsa gerek.. BTK'nın raporlarda ki ODAK Noktasın İşletmeci tarafından "HİZMET(LER)"; Bir abonenin birden fazla hizmeti olabilir (aynı adreste bile olsa) Ev, İş, Yazlık, Kışlık, Merkez, Şube veya depo, hatta aile bireylerinden bir başkasının adresine bile kendi adın İSS hizmeti alabilir.. böyle bir durumda her bir hizmet için ayrı ayrı kayıtlar oluşturulacaktır. böyle bir durumda  zaten sipariş öncesinde WHMCS admin panelindeki "clients profile" sayfası üzerinden ihtiyaç duyulan verilerin girişini sağlanmış olduğundan Whmcs "orders add" Ürün/Hizmet Sipariş Ekranında "Yerleşke Adresi ile Tesis Adresi Aynı" seçim kutucuğu (bu kutucusuk defauld olarak seçili gelsin bunun nedeni ise abone potansiyeli genelde ev kullanıcılarından oluşuyor.) ilave edilsin ve siparişi gönder tuşuna basılması ile birlikte WHMCS "clients services" alanına hooks yardımı ile oluşturduğumuz alanlara otomatik yazsın. bu kutucuk işaretli olmaz isen siparişi gönder tuşuna bastıktan sonra (normalde sipariş onayına gider iken) WHMCS admin panelindeki "clients services" sayfası yönlenmesini sağlanacak.. ve ihtiyaç duyululan verilerin girişini sağlamak için Modülün service_details.tpl sayfasının enjekte edilmesi sağlanacak. son aşamada WHMCS admin "clients services" sayfasının alt kısmındaki "Değişiklikleri Kaydet" butonu ile gerekli bilgilerin "whmcs'nin ilgili alanlarına ve BTK Modülüne ait (SQL) alanlara kaydı sağlandıktan hemen sonra (bu aşamaya kadar sipariş onayında bekliyor olan hizmetler için) yine "clients services" ekranında ki "Değişiklikleri Kaydet" butonunu hemen yanına bu sefer "Siparişi onayla" tuşu otomatik gelsin..  şayet bu tuşu getirme kabiliyeti yok ise ilgili hizmetin (orders.php?action=view&id=xxx) sipariş onay ekranına gidilsin. Tüm bu aşamalara kadar BTK için gerekli Tüm "ABONE REHBER" ve "ABONE HAREKET" için ihtiyaç duyulan tüm verilerin Büyük bir kısmı MODÜLÜN SQL TABLOSUNDA, Bir Kısmı ise ilgili WHMCS SQL Tablolarında Oluşmuş olacaktır. "Siparişi Onayla" Tuşuna  basıldığı an  "ABONE REHBER" ve "ABONE HAREKET" dosyalarına (314_KK_Abone_Desen.pdf Teknik dokumanda ifade  edilen kurallara uygun bir şekilde) "YENI ABONELIK KAYDI" oluşturulur. burada dikkat edilecek husus Bir Aboneye veya Hizmete ait veriler daha önceden bir başkaca tablolara kayıt edilmeli  ki "ABONE REHBER" ve "ABONE HAREKET" dosya içerikleri  "siparişi onayla" tuşuna basılması ile oralardan çekilmeli ya temp bölümünde (ki bu veri kaybına yol açabilir diye düşünüyorum) en sağlıklısı "ABONE REHBER" ve "ABONE HAREKET" dosya içeriklerinin tamamını barındıran örneğin "mod_btk_abone_rehber.sql" ve "mod_btk_abone_hareket.sql" tablolarına anlık olarak işlensin. Modül içindeki BTK Abone Veri Raporlama sayfasından (generate.tpl) yapılan işlemlerde Mevcut hiç bir veriyi silmeden rapor oluşturma ve gönderme işlemleri yapılır iken verilerin içeriği ve daha önce (manuel veya cron ile) gönderilip gönderilmediği kontrol edilerek şayet aynı verileri içeren bir rapor daha önce oluşturulmuş, ftp klasörüne yüklenmiş ise (bunun içince bir sql tablo gerekebilir dosyaların adlarının ve ftpye yükleme tarihlerinin ve aynı içerikli dosyanın kaç sefer gönderildiğini bir tabloda tutmak gerekir) daha sonraki aynı içerikteki mükerrer dosyalar, ilk oluşan dosyaların ismi aynen alacak ancak aynı içerikteki dosyanın kaç sefer oluşturulduğu ve ftpye yüklendiğini bilgisi de bir sql tabloda tutulmalı ki 314_KK_Abone_Desen.pdf  Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak iletilir. Talimatları doğrultusunda; CNT (Count) oluşturulsun." burada önemli husus içeriklerin aynı olması durumudur. içeriklerin farklı olması halinde yeni bir dosya ismi ile yeni bir dosya oluşturulur.
bu arada config bölümüne ftp bilgilerinin yer aldığı ekranın hemen alt kısmına hangi dosyanın hangi zaman aralıklarında ve hangi saatte ftp sunucuna yükleneceğine dair cron çalışma zamanlamasına ait bölüm eklesin.
"ABONE REHBER" dosyasının gönderim zamanı defauld olarak "her ayın ilk günü saat 10:00" ve "ABONE HAREKET" dosyasının gönderim zamanı defauld olarak "her gün saat 01:00" olmalı ancak BTK'dan gelecek yeni talimatlar dosyasında bu cronların zamanlamalarına ilişkin değişikliğin bir kod değişikliğine ihtiyaç duymadan ekrandan ilgili personel tarafından değişiklik yapılabilmeli.
"ABONE REHBER" tablosunda oluşan hiç bir verinin, hiç bir şekilde ( Abone sözleşmesi, veya iptali durumunda dahi) silinmesi söz konusu dahil olamaz.
Ayrıca Hizmet veya Ürünün İPTAL bilgisi girildiği an  "ABONE REHBER" dosyasına "IPTAL" işlemlerine dair son güncelleme yapılırken aynı anda ve "ABONE HAREKET" dosyası son kez "IPTAL" işlemine ilişkin satır oluşturulur.
Hakkında "IPTAL" İşlemi yapılan "ÜRÜN/HİZMETLERİN" WHMCS sistemi içindeki herhangi bölümde Hizmete dair bilgilerin değiştirimesine edilmesi engellenmeli.
Hakkında "IPTAL" İşlemi yapılan "ÜRÜN/HİZMETLERİN" WHMCS sistemi içindeki herhangi bölümde Hizmetin tekrar aktif edilmesi engellenmeli.
Ayrıca (Sonradan İPTAL edilmiş Bile olsa..)  ONAYLANMIŞ Hiç bir Hizmetin SİLİNMESİNE DE İZİN VERİLMEMELİDİR!
BTK'nın yetki iptal sebebi sayabileceği kadar önemli olan bu konularda hassasiyet göstermeni Bireysel Abonelerde "Abone Numarası, TCKN, Ad Soyad" Kurumsal Abonelerde ise "Abone Numarası, UNVAN, MERSİS NO" gibi değiştirilmesi hayatın doğal akışına aykırı olan verilerin hiç bir şekilde değiştirilmesine veya silinmesine izin verilmemelidir.
Nerede Kaldık :) "ABONE HAREKETLERİ" dosyası EVET her bir hareket için ayrı ayrı bir kayıt satırı oluşacak olsa da bazen özellikle geriye dönük hukuki süreçlerde "BORÇTAN KAPAMA veya IPTAL" gibi veya benzeri konularda mahkemelere dava ve delil konusu olacak bu raporlarda hayati derecede öneme sahip... EVET bu veriler FTP Sunucuna gönderiliyor ama "HER NE KADAR SUNUCUNUN MÜLKİYET HAKKI BİZE AİT BİLE OLSA.. HATTA FİZİKİ OLARAK KENDİ OFİSİMİZDE BARINDIRIYOR OLSAK BİLE.. SUNUCUNUN YÖNETİMİ BTK TEKNİK PERSONELİNE AİT" Bizler de sadedece O sunucunun belirli klasörlerine ilgili verileri yükleyebiliyoruz.. Sunucu içindeki bir ALGORİTMA İlgili Klasöre, İlgili Veri Doğru şekilde yüklendi mi önce onu analiz ediyor sonra sıkıştırılmış bile olsa ilgili verinin içeriğini satır satır kontrol ediyor örneğin AD, SOYAD ve TCKN uyumsuzluğu ve/veya NVİ ADRES KODU ile girilen Adres alanları doğrulanıyor mu diye içerik analizini de yaptıktan sonra şayet satırların herhangi bir hata ile karşılaşırsa bir hat log dosyası oluşturuyor şu abonenin TCKN'si doğrulanamadı gibi.. Hiç bir hata yok ise bu dosyayı sunucuda bizim erişimine hatta görmemize bile yetkimizin olmadığı başka bir klasöre otomatik olarak aktarılıyor.. artık o dosyaya bizim hiç bir şekilde erişimimiz kalmıyor. BTK RAPORLARI 5651 Sayılı katalog suçlarla mücadele kapsamında değerlendiriyor ancak bizimde hukuki süreçlerde geriye dönük bir şekilde bu verilerin zaman damgalı bir şekilde kayıt altında tutulması REHBER zaten hiç bir şekilde SİLİNMESİ SÖZ KONU BİLE OLAMAZ.. ama hareketlerin SQL veri tabanını şişireceği endişesi içerisindeyim. bu konuda senin önerin nedir?
btkreports_deactivate(): Modül devre dışı bırakıldığında çalışır SQL dosyaların silinip silinmeyeceğine ilişkin zaten config ekranında bir seçim kutucuğu var. aynı uygulama devam etsin.
Genel Ayarlar:
Operatör Kodu (Text, BTK Teknik ekibi tarafından sözlü olarak bildirilir)
Operatör Adı (Text, BTK Teknik ekibi tarafından sözlü olarak bildirilir)
Bu bilgilerin sözlü olarak aktarıldığı ve geçmiş dönemlerde SİZİN OPERATÖR ADINI IZMAR değil IZMARBILISIM olacaktı gibi olayların da yaşandığı düşünecek olursa sabit readonly olmasındansa config ekranından yönetilebilir olması daha doğru olacaktır.
Hiç bir aksilik olmasa bile işletmemiz zaman içinde belki de Ticari UNVANINI Değiştirme cihetine gidebilir böyle bir olayda OPERATÖR KODU VE OPERATÖR ADI da değişmesi sözkonusu olacaktır.
Ve modülümüzün ESNEK GELİŞİME AÇIK OLMA İlkelesine de ters düşecektir.
ANCAK DEĞİŞTİRELEMEZ BİLGİLER OLARAK READONLY OLABİLECEK VERİLERDE VAR ÖZELLİKLE BİREYSEL VEYA KURUMSAL ABONE Bilgilerindeki değiştirilmesi doğanın akışına ters olan doğumdam ölüme değişmesi mümkün olmayan veriler için söz konusu olsun
tekrar özet geçecek olursak;
öncelikle ben türküm ve modülü kullanacak personeller de türk onun için iyi derecede türkçe öğrenmelisin :)
Tüm proje boyunca ALTIN KURAL olarak uygulamanı istiyorum! Tüm dosyalar sanki ilk versiyonmuş gibi eksiksiz ve tam olarak göndermeni istiyorum  (ara sürüm güncelleme dosyası olarak değil) Tam sürüm dosyası olarak TAM VE EKSİKSİZ UNUTMA BU ALTIN KURAL!
Proje boyunca bana iş yüklemeyeceksin. tüm projenin hata ayıklama veya geliştirme aşamalarında ben sadece testter olarak katıkı sunacak ve sana sonuçlar hakkında geri dönüşler sağlayacağım.
FTP SUNUCULARA İLİŞKİN:
Projede neden iki ayrı ftp sunucuna ihtiyaç duyduğumuz aklına takılmıştır. Öncelikle ANA FTP (BTK FTP SUNUCUSU) Mülkiyeti bize ait olsa da hatta fiziki sunucunun bize ait veri merkezinde olmasına rağmen, yönetimi tamamen BTK teknik Personeli tarafından yapılmaktadır. Biz BTK FTP SUNUCUSUNUN İlgili Klasörüne ilgili dosyayı attıktan sonra BTK FTP SUNUCUSU içinde bir algoritma dosyanın önce dosya formatını, sonrada dosya içeriğini inceliyor eğer veride bir hata veya eksiklik yok ise.. yine aynı sunucunun içinde ama bizim erişim yetkimizin olmadığı olmadığı bir klasöre kaldırılıyor. Şayet ilgili dosyada bir eksiklik veya hata bulunursa hangi abone ve/ya hizmetlerde hata veya eksiklik olduğunu anlatan bir hata dokumanı oluşturuyor ancak her iki aşamada da bizim göndermiş olduğumuz dosya(ları) yine bizim erişimimize kısıtlı olan bilmediğimiz bir başka klasöre taşınıyor. BTK Bu verileri 5651 Sayılı Kanun Kapsamında Sorumlu olduğu katalog suçlarla ilgili mücadele kapsamında bizlerden istiyor ancak bizler de de (başka bir fiziki FTP sunucuda) bir yedeğinin olması böylece gönderimde veya ilerdeki sakla sürecinde oluşacak disk veya başka sorunlarda oluşacak veri kaybının önüne geçmek istiyoruz. Bir başka amacımızda BTK 5651 kapsamında bu verileri saklarken bizde ileride herhangi bir abonemizde hukuksal bir anlaşmazlık yaşadığımızda (Borç İlişkisi veya Hizmet Alıp almadığı gibi... ) Konularda  ilerde yaşanabilecek mahkeme süreçlerine dayanacak olabilecek şekilde zaman damgalı şekilde arşivlemek istiyoruz. bu arsivi SQL Tablolar içinde canlı veri olarak tutmak bir süreliğine mümkün olsa da zaman içinde SQL veri tabanı şişecektir. SQL veritabanı yönetilemez hale gelecek ve sistem ağırlaşacaktır. o yüzden ikinci bir FTP (YEDEK) SUNUCU tanımlama ekranı için alan açmanın en azından seçenek olarak sunulmasını.. (Yedek FTP Sunucusu Kullanmak istiyorum Evet/Hayır) seçim kutucuğu default olarak "Hayır" olsun ancak Evet seçildiği an daha önce sadece FTP (BTK) Sunucunun Bilgileri görünüyor iken.. Aynı ekranda en uygun yere YEDEK FTP SUNUCU Bilgilerine dair verilerin girileceğin alanlar SEÇİM YAPILINCA OTOMATİK BELİRSİN. Ne düşünüyorsun? yapalım mı?
ayrıca BTK FTP SUNUCUSUNDA Oluşan dosya hatalarına ilişkin verilerden söz etmiştim sana.. projenin ilerleyen aşamalarında (FİNALE YAKIN BİR ZAMANDA OLABİLİR) Bu hata dosyalarını (bad_REHBER_202311061155.gz veya hata_ozet_REHBER_202311061155.gz gibi) içeriklerini okuyup bizim loglarımıza yazmayı hatta mümkünse ekrana filanca abone veya ürün bilgisinde hata var diye uyarı getirebilmesini hedefleyelim ne dersin?
Rapor dosyalarına ilişkin detaylar:
daha önceki modül çalışmalarımızda oluşturulan dosyaların uzantı veya adların teknik dokumandan farklı bir durumla karşılaşmıştım. tekrar belirtmekte fayda var; senden fark ettin mi dosya isminin tamamı BÜYÜK HARF iken, uzantılar ".abn" ve ".gz" görüldüğü gibi küçük harf olarak belirlenmiş buna dikkat etmekte fayda var birincisi bu dosyalar yüklenildiği an BTK tarafında ki ftp sunucularda da bir dosya adı ve içeriğini dair denetim algoritması var.. buna takılmak istemiyorum. Diğer bir konuda da olurda dosya sorun çıkarmasa bile BTK TEKNİK Personeli biz senden böylemi istedik demesin :)
Örnek dosya isimi:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn”
SIKIŞTIRILMIŞ OLARAK FTP SUNUCUNA GÖNDERİLENLERE DOSYALARA ÖRNEK:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn.gz”
Raporlama Kolaylığı: Cron job çalıştığında, FTP'ye gönderilecek ABONE REHBER ve ABONE HAREKET dosyaları doğrudan bu SQL tablolarından sorgulanarak oluşturulur. Hareket dosyası oluşturulduktan sonra, gönderilen hareketler mod_btk_abone_hareket tablosundan silinebilir veya "gönderildi" olarak işaretlenebilir. önergesini daha da netlik katalım.
ABONE REHBER tablosundaki hiç bir verinin zaten silinmesi söz konusu olmayacak (aboneye dair hizmet iptal olsa dahi hatta abone ölse , şirket ise batsa dahi) onlara ait REHBER dosyasındaki hiç bir veri silinmeyecek.. SON defa bir IPTAL güncellemesi yapılacak. Sebebi ve TÜRÜ ne olursa olsun İPTAL işlemi yapılan bu hizmet hiç bir şekilde bir daha aktif edilmemeli ancak WHMCS burada biraz farklı davranıyor İPTAL edilmiş bir hizmet WHMCS clients services ekranından yine durumu aktif edilebiliyor bunun kesinlikle önüne geçmeliyiz. İPTAL ÖLÜ DEMEKTİR.. ÖLÜ DİRİLMEZ HAKSIZ MIYIM?
bu arada ABONE HAREKET içinde aynı kurallar geçerli İPTAL olan bir hizmete dair SON kez İPTAL içerikli bir hareket satırılı oluşturulur. ve bir daha o hizmet asla hareket görmemeli! bunu senin de dediğin gibi SQL tabloda bayraklamak ile işaretlemek ile mümkün..
ayrıca ABONE HAREKET dosyası hakkında şöyle bir fikir birliğinize varmıştık..
ABONE HAREKET tablosu bir günde bile (şu an aktif abone sayısı 500 Olduğunu ve günde her abone günlük 10 hareket geliştirse desek ABONE HAREKET sadece bir günde 5000 satıra oluşacak..ve bu SQL tablosundan çekilecek BTK sunucuuna gönderilecek olan "ABONE HAREKET" dosyasının hazırlanma süresini geciktirecektir.. ABONE HAREKET dosyalarını her gün saat 01:00’da iletecek, abone hareket dosyaları bir önceki güne ait değişiklikler ile önceki gönderilen abone hareket dosyalarında iletilmeyen değişiklikleri içerecek olmasından anlaşılacağı üzere takriben günde en az 5000 satırlık (Her yeni abone ile bu daha artacak olan) bir tabloyu hem canlı verilerin çekildiği hem de uzun süreli bir arşiv tutmak çok akıllıca olmayacak diye karar verdik hatırlıyor musun?
onun için iki farklı "ABONE HAREKET" tablosu oluşturalım;
ilk ve canlı "ABONE HAREKET" tablosu: kaç günlük veriyi içereceğini (en az 2 günlük olmak kaydı ile)  modülün uygun sayfasında (Büyük ihtimal ile Raporlara ilişkin sayfayı biraz daha geliştirmemiz gerekecek) belireceğimiz süre aralığında ki tüm canlı (anlık) veriler tutulacak (niye en az 2 günlük.. BTK FTP sunucusuna gönderim yapıldıktan sonra aynı gün içinde oluşacak veriler BTK'nın tabiri ile gönderilemeyen hareketlerin 2. güne sarkabileceğini ön gördük.) (Niye sadece 2 güne sabitlemek yerine modül içinde bur süreyi istediğimiz gibi dinamik tutmalıyız:  Çünkü bazen BTK tarafındaki otomasyon dosya formlarını ve/veya içeriklerini kontrol etmekte gecikebiliyor... Böyle bir durumda şayet gönderdiğimiz dosya veya içeriği hatalı ise BTK o dosyaları yeniden gönder bize diyebiliyor.. bu ara bir dipnot daha: BTK' ya bir rapor içeriği ilk defa gidiyor ise ("ABONE REHBER" ve "ABONE HAREKET") için uygulanacak CNT formülünü hatırlıyorsun değil mi? işte bu aşamada bize  tabloda üç ayrı alanın daha gerekiyor;
ilk alan: BTK'ya gönderilen satırların işaretlenmesi senin tabirinle bayraklama işlemi için ihtiyacımız olacak.
ikinci alan : CNT (Count) Alanı : BTK'ya gönderilecek olan verilerin içeriklerin gönderilmesi esnasında belirnen dosya isimlerini oluşturan elementlerden birisi olan CNT sayısının tutulacağı alandır. bu alan veri ilk oluşturulur iken DEFAULT olarak (01) olmalıdır. BTK tarafından Aynı içeriğine sahip Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak. buradaki maksat dosyaların aynı isimler birbirlerinin üzerine kayıt edilmesinin önüne geçmek olabilir veya her iki dosyayı elde tutup doğrulamak için de olabilir.
üçüncü alan: İlgili verinin dahil edildiği BTK dosyanın adını içerecek alandır.
ÖRNEK : IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn
Şayet bu üç tabloyu oluşturmaz isek btk bir veriyi tekrar istediğinde içerik olarak aynı olsa da (dosya oluşturma algoritması arasında yer alan sistem tarihi, ve saati değişeceği için BTK bunu istemiyor. Gönderilen ilk dosya adı ile ama CNT bir artırılmış olarak gönderilmesi istenmektedir.
CNT (Count): Dosyanın tekrar gönderilmesi talep edildiğinde iki haneli kod birer arttırılarak iletilir.
Örnek dosya isimi:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn”
SIKIŞTIRILMIŞ OLARAK FTP SUNUCUNA GÖNDERİLENLERE DOSYALARA ÖRNEK:
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20170315162500_02.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_HAREKET_20170315162500_01.abn.gz”
“IZMARBILISIM_701_ISS_ABONE_REHBER_20180529130059_01.abn.gz”
Dosya yapısı ve içeriğine ait bilgilerin tamamı zaten BTK TEKNİK 314_KK_Abone_Desen.pdf Dokümanında mevcut.. ben sana tekrar hatırlatmak istedim.
ARŞİV "ABONE HAREKET" tablosu: Canlı (anlık) veri tablosunda ki verilerin (canlı tablodaki konaklama (bulundurulma süresi dolan verilerin) Arşivleneceği bir tablodur.
Bu arşivlemenin Kaç günlük veriyi içereceğini modülün uygun sayfasında (Büyük ihtimal ile Raporlara ilişkin sayfayı biraz daha geliştirmemiz gerekecek) belirlemeliyiz. Zaten BTK'ya (ANA FTP SUNUCUSUNA) gönderilen Her dosya aynı anda YEDEK FTP sunucuna gönderiliyor iken tekrar böyle arşivlemeye neden ihtiyaç duyuyoruz. Evet YEDEK FTP SUNUCUMUZDA bu verilerin tamamı saklanacak ancak bu öyle bir hale gelecek ki bu dosyaların kapsamı on yılları aşacak (şu an faaliyetimizin 12. yılındayız) olur da canlı verinin yaşam süresini aşan bir veriyi BTK talep edecek olursa en azından (SQL yapımızın kaldırabileceğin süre boyunca) 5-6 aylık süre ile bile olsa verilerin burada sistemin içinde (ARŞİV "ABONE HAREKET") tablosunda mevcut bir veri ise hemen bir dakika içinde BTK tarafından istenen verinin yeniden gönderilmesi sağlanabilecektir. CANLI tarafta ki tekrar gönderim aşamaları ve gerekli tablolar zaten aynı olacaktır.
ayrıca bir konuda bir ilave daha yapmamız gerekiyor;
Ola ki "ABONE HAREKET" ve/veya "ABONE HAREKET" verileri arasında  SQL tablolarda yaşam süresi doldurduğu için artık tabloda yer almayan bir veri veya veri kümesini BTK aradan yıllar geçse bile.. (Bu bilgilerin saklanma süresi MEVZUATTA 30YILDIR) şu isimli veya şu tarih aralığındaki "ABONE HAREKET", "ABONE HAREKET", "PERSONEL LİSTESİ" BTK'ya gönder talebi geldiğinde bu talebi otomatik olarak sağlayacak şekilde bir FTP YEDEK SUNUCUDAN GÖNDER başlığı altında bir alan olmalı bu alanda;
zaten modülün config ekranında tüm ilgili dosyalara ait FTP dosya yolları belli olduğu için aranacak yerler zaten belli.. YEDEK sunucudan çekilecek VERİNİN TÜRÜ bir drop menü ile çekilebilir ""ABONE HAREKET", "ABONE HAREKET", "PERSONEL LİSTESİ" ) türünden sonra iki search alanı olmanı birisi dosya ismi diğeri de verilen iki tarih arası aramada listenene dosya(lar) ekrana listenir ve yanlarında BTK'ya yeniden gönder sekmesi seçilerek işlem başlatılmışmış olur. burada süreç biraz daha farklı ilerleyecektir. Çağrılan sıkıştırılmış ".gz" dosyası ve onun içinde yer alan ".abn" dosyasının içeriğine hiç bir değişiklik yapılmayacak ancak tekrar gönderilen dosyaların adına ilişkin CNT bir artırılması kuralığı gereği sıkıştırılmış dosyanın içindeki ".abn" dosyası temp klasöründe ".gz" içinden çıkarılarak dosyanın adındaki CNT bir artırılarak yeniden ".gz" formatında sıkıştırılması sağlanmalı (".abn" dosya adı değiştiği için zaten ".gz" ismi de değişmiş olacak.. bu benim aklıma gelen olan bir yöntem başkaca teknikler de üretebiliriz.
Belki de BTK en başından "yeniden gönder" yapısının böyle kurgulanmasını istiyor olabilir... öyle bir durumda oturup yeniden modülü yeniden yazmak zorunda kalmayız... BTK nereden hangi metodla isterse o şekilde göndeririz :)
Şayet vefatı tespit edilebilecek bir seçenek yok ise Periyodik NVI doğrulamalarında, eğer bir TCKN artık doğrulanamıyorsa (ki bu vefat dışı sebeplerle de olabilir), bu son derece doğru bir tespit bu konuda ekranda ve ayrıca loglarda bir uyarı Şu aboneye ait TCKN artık geçersiz diye bir uyarı verilir ise ilgili personelin aboneye çeşitli iletişim araçları üzerinden erişmeye ve yaşayıp yaşamadığına teyit edilmesi ve bu teyit durumunda vefat işlemlerinin manuel başlatılması için bir seçenek ilave edilebilir. https://tckimlik.nvi.gov.tr/Home bu sayfayı derinlemesine bir incelemen gerekiyor
ayrıca en az TCKN no kadar önemli bir doğrulama da "ADRES KODU" doğrulaması bununla ilgili görüşmelerimizi hatırlıyor musun? https://adres.nvi.gov.tr/home Abone Yerleşke ve tesis adreslerinin  UAVT, "Ulusal Adres Veri Tabanı" doğrulanması ve UAVT Numarasının  doğru olarak girilmesi sağlanmalıdır. bir araştırma yapmalısın https://adres.nvi.gov.tr/VatandasIslemleri/AdresSorgu veya benzeri sitelere bizdeki adres bilgilerin enjekte ederek ADRES KODU'nu doğruyabilecek miyiz bir araştırma yapanı istiyorum
BTK mevzuatlarına göre bir abonenin (hizmet(leri) iptal edilse hatta abone vefat etse bile) "ABONE REHBER" yapısında bazı veriler hayatın doğal akışında da olduğu gibi "Bireysel abonelerde TCKN, Adı, Soyadı gibi.. ) "Kurumsal abonelerde Vergi Kodu ve Mersis Kodu gibi) hiç bir suretle değişmesi mümkün olmayan verilerin modül içinde de değişmesine veya silinmesine hiç bir şart altında izin verilmemesi gerekiyor.
Bu konuya ek olarak hatırlıyor musun NVİ üzerinden TCKN doğrulaması yaptırmamız gerekiyordu.. bu konuda bir araştırma yapmalısın bu kişilerin hayatta olup olmadığını.. şayet vetfat etmiş ise tüm hizmetlerinin BTK Teknik dokümanında ki VEFAT eden abonelere uygulanması istenen işlemlerin yapılmasını da sağlamalıyız. bu konuda iyi bir araştırma yapmalısın.
modül temamızın genel prensibi modülü kullanacak olan personeli aynı zamanda özellikle BTK Usul ve mevzuatları noktasında küçük bilgi notları sayesinde eğitmektir. modülün gerekli tüm ilgili alanlarına özellikle veri giriş alanlarının yanına yakınına (i) info simgesi eklemeni kliklemeye gerek kalmadan, ilgili info simgesinin üzerine gidildiğinde ufak ta olsa bir bilgilendirme balonu açılmasını istiyorum. bu talebimi hatırlıyor musun?
bu ufak bilgi notlarını hazırlayabilmek için BTK web sayfalarından yararlanabilirisin.
Bu modül resmi bir Devlet kurumu olan BTK trafından yetkilendirilmiş olduğumuz konularda sunduğumuz hizmetlere İlişkin; "ABONE REHBER", "ABONE HAREKET" ve "PERSONEL BİLGİLERİNE"  verilerin, yine BTK tarafından sağlanan TEKNİK DÖKÜMANDA (314_KK_Abone_Desen.pdf) istenildiği şekilde göndermek üzerine olduğu için aşağıda linklerini verdiğim adreslerden tüm ilgili mevzuatlar öğrenmeni istiyorum.
BTK'nın bu göndereceğim bilgilerde usulsüzce bir değişikliğe karşı hiç bir şekilde taviz vermediğini daha net anlaman için sana bir de ceza kararı göndereceğim
https://www.btk.gov.tr/kanunlar
https://www.btk.gov.tr/bakanlar-kurulu-kararlari
https://www.btk.gov.tr/yonetmelikler
https://www.btk.gov.tr/tebligler
https://www.btk.gov.tr/kurul-kararlari (özellikle ceza ve idari yaptırım kararlarını iyi öğrenmelisin ki bizde aynı hatalara düşmeyeleyim)
Burada bir önemli konu daha var;
Personel Listesi:
PERSONEL LİSTESİ (aslında bu veri daha önce BTK' ya e-posta aracılığı ile gönderiliyordu birazda kişisel veri mahremiyetini gözetmek için FTP sunucuna bırakın denildi) dolayısı ile oraya 6 Ayda bir gönderilecek dosya hep aynı isimde olacak "Personel_Listesi.xlsx"
Ancak bu YEDEK FTP yapısında (arşivleme yapılacağı için) baz değişiklikler yapmak zorundayız.
örneğin:
Personel_Listesi_2024-1.xlsx
Personel_Listesi_2024-2.xlsx
EXCELL dosyasının adı Ait olduğu yıl ve gönderilme dönemi veya gönderildiği ay bilgi de eklenerek farklılaştırılmalı böylece dosyalar birbirlerinin üzerine yazılmazlar. bu arada belki de BTK' da gönderimin böyle olmasını istiyordur.
PERSONEL ekranında dosyayı gönderim ekranında dosya adına "YIL-AY" ilave edilsin diye bir seçenek ekleyelim.
Bu her iki FTP (ANA ve YEDEK) sunucu içinde ayrı ayrı sorulsun. böylece hem biz YEDEK FTP Yedek sunucunda dosyaları üst üste yazılmasının önüne geçerek arşivleme yapmış olacağız hem de günün birinde BTK Teknik Uzmanları da dosyaların üzerine yazmayı farklılaştırın dediklerinde bir daha modül yazma derdine düşmeyiz.
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/Personel_Listesi.xlsx
btkya gönderilecek excell dosyası oluşturulacak. ancak excelde olmayan alanlar şimdiden kendi İK yapımızın oluşması için bize veri sağlayacaktır.
EV ADRESİ (BTK için olmasa da İK için, manuel giriş)
ACİL DURUMDA ARANACAK KİŞİ VE İLETİŞİM BİLGİLERİ (BTK için olmasa da İK için, manuel giriş)
İŞE BAŞLAMA TARİHİ (BTK için olmasa da İK için, manuel giriş)
İŞTEN AYRILMA TARİHİ (BTK için, Excel'de sadece mevcut çalışanlar listelenecek, manuel giriş)
İŞ BIRAKMA NEDENİ (BTK için olmasa da İK için, manuel giriş)
Yukardaki alanlar Bizim Kendi İK yapımız için gerekli olacaktır.
BTK LİSTESİNE EKLENSİN (Checkbox, API kullanıcıları gibi kayıtların hariç tutulması için) bu alan ise hatırlıyorsan veri girişi iki şekilde oluşacak. ilki daha modül kurulur iken whmcs yöneticiler (config admins) bölümündeki mevcut olanları modüllümüzün personel bölümüne otomatik olarak çekecek ancak bunlardan bazı (insan olmaya) banka posları veya robotic müşteri temsilcisi v.b. otomasyon API yapılarını yönetmek için tanımlanmış hesaplardır. onları BTK raporundan uzak tutmak için BTK LİSTESİNE EKLENSİN (Checkbox, API kullanıcıları gibi kayıtların hariç tutulması için) yapısına ihtiyacımız var. eksik kaldığım veya unuttuğum bir şey varsa sen tamamla lütfen.. fikrin nedir?
WHMCS admin panelindeki "clients profile" sayfası üzerinden ihtiyaç duyululan verilerin girişini sağlamak için Modülün client_details.tpl sayfasının enjekte edilmesi sağlanacak.
WHMCS admin panelindeki "clients services" sayfası üzerinden ihtiyaç duyululan verilerin girişini sağlamak için Modülün service_details.tpl sayfasının enjekte edilmesi sağlanacak.
WHMCS aynı bilgilerin Müşteri panelindeki Kişisel bilgilerinin ve Hizmetlere ilişkin detay bilgilerin (değiştirilemez şekilde..) görüntülenmesini sağlayacak modülün "client" kodlarının ilave edilmesi sağlanacak.
projeyi biraz daha geliştirelim mi?
BTK raporları arasında yer alan (yetkilendirme konusu İSS kapsamında olan hizmetler için)  "ISS POP BILGISI" hatırlıyorsun değil mi?
bu alan "clients services" ekranındaki hizmete ait sunucu bilgisinden alıyorduk doğru mu?
ancak "314_KK_Abone_Desen.pdf"  teknik dokümanında istenin bilgi sadece sunucu olarak tanımlanan  "ISS POP BILGISI"  yetersiz kalıyor. POP bilgisi aslında  sunucu bilgisinin yanı sıra abonenin bağlı olduğu "BAZ İSTASYON" veya bağlı olduğu "SANTRAL" bilgisinin de eklenilmesi gerekiyor. Ayrıca ek olarak süreli bir döngüsü olmasa da zaman zaman BTK tarafından SANTRAL veya BAZ İSTASYON bilgilerinin (Resmi Evrak ile) istenebiliyor.
Her iki talebi de karşılayabilmek için ek olarak "ISS POP NOKTASI" içeren sql tablosuna ihtiyaç duyulacaktır.
https://github.com/kablosuzonline/WHMS-BTK-MODUL/blob/main/kutuphane/iss_pop_nokta_listesi.xlsx excel  dosyasındaki bilgilerin girişini sağlayabilecek yeni bir sayfaya ihtiyacımız olacak. buraya bilgileri manuel olarak girilebildiği gibi bir excel dosyası üzerinden import ve export işlemi de yapılabilmeli böylece BTK pop bilgilerini talep ettiğinde hızlıca güncel bir excel tablosuna kavuşmuş olacağız
BTK raporarında kullanılmak için ihtiyac duyulan (ISS POP BILGISI) alanı için ise;
İlgili hizmete ait "clients services" ekranındaki sunucu bilgisinin olduğu en yakın ve en uygun yere enjekte edilmek üzere "ISS POP NOKTASI" tablosundaki  "YAYIN YAPILAN SSID" alanındaki (Hizmete ait "TESİS ADRES İLÇE adresi ile eşleşmesi koşulu ile) veriler drop menuler ile çağrılarak bu sayfa üzerinden girişi sağlanacak böylece ISS POP BILGISI alana ait veri şu şekilde oluşacaktır: "clients services" ekranındaki sunucu ve YAYIN YAPILAN SSID
ISS POP BILGISI: SUNUCU.YAYIN YAPILAN SSID
Şayet  "clients services" ekranındaki drop menu de bir "YAYIN YAPILAN SSID" verisi seçilmedi ise o vakit sadece SUNUCU yeterli olacaktır. "YAYIN YAPILAN SSID" alanı zorunlu alan değildir.
Dropdown'daki "Yayın Yapılan SSID" listesi çok uzun olabilir. İlçe filtresi iyi bir başlangıç ancak bu filtrelemeyi kod içinde değil de en uygun hangi ekrana olur bilmiyorum ama bizim seçebileceğim bir alan olsa iyi olmaz mı "TESİS ADRES İL", "TESİS ADRES İLÇE", "TESİS ADRES MAHALLE" üç opsiyonu bazen kullanmak zorunda kalabiliriz örneğin bazen birbirlerine çok yakın sınır ilçelerin santrali üzerinden diğer ilçedeki bir aboneye de hizmet verebiliyoruz... ek olarak tamam yukardaki üç opsiyondan birini seçebileceğim bir alan koyduk ancak drop menü alanına tıkladığında veya senin tavsiye edebileceğin başka bir yöntemle drop alanını sanki bir search arama alanınymış gibi zaten teknik ekip tarafından aboneyi hangi istasyona bağladıklarına dair gelecek olan bilgiyi girerek hatta girdikçe drop alanında eşleşenlerin ekrana geldiğini ve nihayet abone hizmetinin sağlandığı cihazın "Yayın Yapılan SSID" gelmesi sağlanır. bu veriyi elle girmekten bahsetmiyorum elle girmek klavye ve insan hatasından kaynaklı yanlı bir "Yayın Yapılan SSID" giriş riskini doğurur.
iltreleme Kriteri Seçimi (Opsiyonel - clients services ekranında):
"Yayın Yapılan SSID (POP Noktası)" dropdown'ının hemen üstüne veya yanına, kullanıcıya POP noktası listesini nasıl filtrelemek istediğini soran bir başka küçük dropdown veya radio button grubu eklenir iken default seçenek olarak en küçük veri kümesi olan "TESİS ADRESİ MAHALLE" olsun böylece dropdown en küçük veri kümesi ile hızlı bir başlangıç yapar. gerek duyarsa ilgili personel il veya ile olarak değiştirebilir. Ama bu değişiklik sadece ilgili hizmet için geçerli olacaktır. Bir sonraki bir başkaca yeni bir hizmet için yine defauld "TESİS ADRESİ MAHALLE" olacaktır.
"TESİS ADRESİ MAHALLE" bilgisinin hem müşteri hizmet detaylarında hem de mod_btk_iss_pop_noktalari tablosunda tutarlı bir şekilde mevcut ve eşleştirilebilir olması önemlidir. Zaten elimizde bir İL, İLÇE ve MAHALLE tablosu ve bunlar arasında ilişkilendirmelerin yapıldığı bir adres tablolarımız yok mu? oradan önce "TESİS ADRESİ İL" seçilir, seçilen İL'e ait "TESİS ADRESİ İLÇE" gelir, Seçilen İLÇE'den sonra "TESİS ADRESİ MAHALLE" otomatik gelecektir. zaten   clients services ekranındaki TESİS adres bilgileri aynı yöntem ve aynı tablolar üzerinden çekileceği için EŞLEŞMEME sorunumuz ortadan kalkacaktır.

Lütfen öncelikle bu proje hakkında edindiğin tüm bilgileri  ve öğrendiklerini bir ön rapor gönder. UNUTMA BU YENİDEN KOD YAZMA İŞİ DEĞİL ZATEN YAZILMIŞ AMA SORUNLARI OLAN BİR MODÜLÜN HATALARINI AYIKLAMA VE GELİŞTİRME İŞİDİR.